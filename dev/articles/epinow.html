<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Using epinow() for running in production mode • EpiNow2</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Using epinow() for running in production mode">
<meta name="robots" content="noindex">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">EpiNow2</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">1.8.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/EpiNow2.html">Get started</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-reference" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Reference</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-reference">
<li><a class="dropdown-item" href="../reference/index.html">R Reference</a></li>
    <li><a class="dropdown-item" href="https://epiforecasts.io/EpiNow2/stan/">Stan Reference</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-model-definitions" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Model definitions</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-model-definitions">
<li><a class="dropdown-item" href="../articles/estimate_infections.html">estimate_infections()</a></li>
    <li><a class="dropdown-item" href="../articles/estimate_secondary.html">estimate_secondary()</a></li>
    <li><a class="dropdown-item" href="../articles/estimate_truncation.html">estimate_truncation()</a></li>
    <li><a class="dropdown-item" href="../articles/gaussian_process_implementation_details.html">Gaussian Process implementation details</a></li>
  </ul>
</li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-usage" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Usage</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-usage">
<li><a class="dropdown-item" href="../articles/estimate_infections_workflow.html">Workflow for Rt estimation and forecasting</a></li>
    <li><a class="dropdown-item" href="../articles/prior_choice_guide.html">Prior choice and specification guide</a></li>
    <li><a class="dropdown-item" href="../articles/estimate_infections_options.html">Examples: estimate_infections()</a></li>
    <li><a class="dropdown-item" href="../articles/epinow.html">Using epinow() for running in production mode</a></li>
    <li><a class="dropdown-item" href="../articles/forecasting_multiple_data_streams.html">Forecasting multiple data streams</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-case-studies" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Case studies</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-case-studies">
<li><a class="dropdown-item" href="../articles/case-studies.html">External case studies and use in the literature</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/epiforecasts/EpiNow2/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Using epinow() for running in production mode</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/epiforecasts/EpiNow2/blob/main/vignettes/epinow.Rmd" class="external-link"><code>vignettes/epinow.Rmd</code></a></small>
      <div class="d-none name"><code>epinow.Rmd</code></div>
    </div>

    
    
<p>The <em>EpiNow2</em> package contains functionality to run
<code><a href="../reference/estimate_infections.html">estimate_infections()</a></code> in production mode, i.e. with full
logging and saving all relevant outputs and plots to dedicated folders
in the hard drive. This is done with the <code><a href="../reference/epinow.html">epinow()</a></code> function,
that takes the same options as <code><a href="../reference/estimate_infections.html">estimate_infections()</a></code> with
some additional options that determine, for example, where output gets
stored and what output exactly. The function can be a useful option
when, e.g., running the model daily with updated data on a
high-performance computing server to feed into a dashboard. For more
detail on the various model options available, see the <a href="estimate_infections_options.html">Examples</a> vignette, for more
on the general modelling approach the <a href="estimate_infections_workflow.html">Workflow</a>, and for
theoretical background the <a href="estimate_infections.html">Model
definitions</a> vignette</p>
<div class="section level2">
<h2 id="running-the-model-on-a-single-region">Running the model on a single region<a class="anchor" aria-label="anchor" href="#running-the-model-on-a-single-region"></a>
</h2>
<p>To run the model in production mode for a single region, set the
parameters up in the same way as for <code><a href="../reference/estimate_infections.html">estimate_infections()</a></code>
(see the <a href="estimate_infections_workflow.html">Workflow</a>
vignette). Here we use the example delay and generation time
distributions that come with the package. This should be replaced with
parameters relevant to the system that is being studied.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://epiforecasts.io/EpiNow2/">"EpiNow2"</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'EpiNow2'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Gamma</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>mc.cores <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="va">reported_cases</span> <span class="op">&lt;-</span> <span class="va">example_confirmed</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">60</span><span class="op">]</span></span>
<span><span class="va">reporting_delay</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Distributions.html">LogNormal</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fl">2</span>, sd <span class="op">=</span> <span class="fl">1</span>, max <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">delay</span> <span class="op">&lt;-</span> <span class="va">example_incubation_period</span> <span class="op">+</span> <span class="va">reporting_delay</span></span>
<span><span class="va">rt_prior</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Distributions.html">LogNormal</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fl">2</span>, sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p>We can then run the <code><a href="../reference/epinow.html">epinow()</a></code> function with the same
arguments as <code><a href="../reference/estimate_infections.html">estimate_infections()</a></code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/epinow.html">epinow</a></span><span class="op">(</span><span class="va">reported_cases</span>,</span>
<span>  generation_time <span class="op">=</span> <span class="fu"><a href="../reference/generation_time_opts.html">gt_opts</a></span><span class="op">(</span><span class="va">example_generation_time</span><span class="op">)</span>,</span>
<span>  delays <span class="op">=</span> <span class="fu"><a href="../reference/delay_opts.html">delay_opts</a></span><span class="op">(</span><span class="va">delay</span><span class="op">)</span>,</span>
<span>  rt <span class="op">=</span> <span class="fu"><a href="../reference/rt_opts.html">rt_opts</a></span><span class="op">(</span>prior <span class="op">=</span> <span class="va">rt_prior</span><span class="op">)</span>,</span>
<span>  logs <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="epinow-epinow-1.png" alt="plot of chunk epinow"><div class="figcaption">plot of chunk epinow</div>
</div>
<p>By default, logging messages are printed to the console indicating
the progress of the model fitting and where log files can be found. Here
we have set <code>logs = NULL</code> to suppress these messages. If you
want summarised results and plots to be written out where they can be
accessed later you can use the <code>target_folder</code> argument.</p>
</div>
<div class="section level2">
<h2 id="running-the-model-simultaneously-on-multiple-regions">Running the model simultaneously on multiple regions<a class="anchor" aria-label="anchor" href="#running-the-model-simultaneously-on-multiple-regions"></a>
</h2>
<p>The package also contains functionality to conduct inference
contemporaneously (if separately) in production mode on multiple time
series, e.g. to run the model on multiple regions. This is done with the
<code><a href="../reference/regional_epinow.html">regional_epinow()</a></code> function.</p>
<p>Say, for example, we construct a dataset containing two regions,
<code>testland</code> and <code>realland</code> (in this simple example
both containing the same case data).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cases</span> <span class="op">&lt;-</span> <span class="va">example_confirmed</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">60</span><span class="op">]</span></span>
<span><span class="va">cases</span> <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/data.table/man/rbindlist.html" class="external-link">rbindlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/data.table/man/copy.html" class="external-link">copy</a></span><span class="op">(</span><span class="va">cases</span><span class="op">)</span><span class="op">[</span>, <span class="va">region</span> <span class="op">:=</span> <span class="st">"testland"</span><span class="op">]</span>,</span>
<span>  <span class="va">cases</span><span class="op">[</span>, <span class="va">region</span> <span class="op">:=</span> <span class="st">"realland"</span><span class="op">]</span></span>
<span> <span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>To then run this on multiple regions using the default options above,
we could use</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">region_rt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/regional_epinow.html">regional_epinow</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">cases</span>,</span>
<span>  generation_time <span class="op">=</span> <span class="fu"><a href="../reference/generation_time_opts.html">gt_opts</a></span><span class="op">(</span><span class="va">example_generation_time</span><span class="op">)</span>,</span>
<span>  delays <span class="op">=</span> <span class="fu"><a href="../reference/delay_opts.html">delay_opts</a></span><span class="op">(</span><span class="va">delay</span><span class="op">)</span>,</span>
<span>  rt <span class="op">=</span> <span class="fu"><a href="../reference/rt_opts.html">rt_opts</a></span><span class="op">(</span>prior <span class="op">=</span> <span class="va">rt_prior</span><span class="op">)</span>,</span>
<span>  logs <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span><span class="co">## summary</span></span>
<span><span class="va">region_rt</span><span class="op">$</span><span class="va">summary</span><span class="op">$</span><span class="va">summarised_results</span><span class="op">$</span><span class="va">table</span></span>
<span><span class="co">#&gt;      Region New infections per day Expected change in reports</span></span>
<span><span class="co">#&gt;      &lt;char&gt;                 &lt;char&gt;                     &lt;fctr&gt;</span></span>
<span><span class="co">#&gt; 1: realland    2237 (1380 -- 3751)          Likely decreasing</span></span>
<span><span class="co">#&gt; 2: testland    2226 (1344 -- 3648)          Likely decreasing</span></span>
<span><span class="co">#&gt;    Effective reproduction no.          Rate of growth</span></span>
<span><span class="co">#&gt;                        &lt;char&gt;                  &lt;char&gt;</span></span>
<span><span class="co">#&gt; 1:         0.89 (0.71 -- 1.1) -0.03 (-0.095 -- 0.041)</span></span>
<span><span class="co">#&gt; 2:          0.89 (0.7 -- 1.1) -0.03 (-0.097 -- 0.039)</span></span>
<span><span class="co">#&gt;    Doubling/halving time (days)</span></span>
<span><span class="co">#&gt;                          &lt;char&gt;</span></span>
<span><span class="co">#&gt; 1:             -23 (17 -- -7.3)</span></span>
<span><span class="co">#&gt; 2:             -23 (18 -- -7.1)</span></span>
<span><span class="co">## plot</span></span>
<span><span class="va">region_rt</span><span class="op">$</span><span class="va">summary</span><span class="op">$</span><span class="va">plots</span><span class="op">$</span><span class="va">R</span></span></code></pre></div>
<div class="float">
<img src="epinow-regional_epinow-1.png" alt="plot of chunk regional_epinow"><div class="figcaption">plot of chunk regional_epinow</div>
</div>
<p>If instead, we wanted to use the Gaussian Process for
<code>testland</code> and a weekly random walk for <code>realland</code>
we could specify these separately using the <code><a href="../reference/opts_list.html">opts_list()</a></code>
function from the package and <code><a href="https://rdrr.io/r/utils/modifyList.html" class="external-link">modifyList()</a></code> from
<code>R</code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/opts_list.html">opts_list</a></span><span class="op">(</span><span class="fu"><a href="../reference/gp_opts.html">gp_opts</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">cases</span><span class="op">)</span></span>
<span><span class="va">gp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/modifyList.html" class="external-link">modifyList</a></span><span class="op">(</span><span class="va">gp</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>realland <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span>, keep.null <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">rt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/opts_list.html">opts_list</a></span><span class="op">(</span><span class="fu"><a href="../reference/rt_opts.html">rt_opts</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">cases</span>, realland <span class="op">=</span> <span class="fu"><a href="../reference/rt_opts.html">rt_opts</a></span><span class="op">(</span>rw <span class="op">=</span> <span class="fl">7</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">region_separate_rt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/regional_epinow.html">regional_epinow</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">cases</span>,</span>
<span>  generation_time <span class="op">=</span> <span class="fu"><a href="../reference/generation_time_opts.html">gt_opts</a></span><span class="op">(</span><span class="va">example_generation_time</span><span class="op">)</span>,</span>
<span>  delays <span class="op">=</span> <span class="fu"><a href="../reference/delay_opts.html">delay_opts</a></span><span class="op">(</span><span class="va">delay</span><span class="op">)</span>,</span>
<span>  rt <span class="op">=</span> <span class="va">rt</span>, gp <span class="op">=</span> <span class="va">gp</span>,</span>
<span>  logs <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span><span class="co">## summary</span></span>
<span><span class="va">region_separate_rt</span><span class="op">$</span><span class="va">summary</span><span class="op">$</span><span class="va">summarised_results</span><span class="op">$</span><span class="va">table</span></span>
<span><span class="co">#&gt;      Region New infections per day Expected change in reports</span></span>
<span><span class="co">#&gt;      &lt;char&gt;                 &lt;char&gt;                     &lt;fctr&gt;</span></span>
<span><span class="co">#&gt; 1: realland    2006 (1070 -- 4068)          Likely decreasing</span></span>
<span><span class="co">#&gt; 2: testland    2252 (1414 -- 3790)          Likely decreasing</span></span>
<span><span class="co">#&gt;    Effective reproduction no.          Rate of growth</span></span>
<span><span class="co">#&gt;                        &lt;char&gt;                  &lt;char&gt;</span></span>
<span><span class="co">#&gt; 1:         0.85 (0.61 -- 1.2) -0.042 (-0.11 -- 0.042)</span></span>
<span><span class="co">#&gt; 2:          0.9 (0.72 -- 1.1) -0.027 (-0.09 -- 0.038)</span></span>
<span><span class="co">#&gt;    Doubling/halving time (days)</span></span>
<span><span class="co">#&gt;                          &lt;char&gt;</span></span>
<span><span class="co">#&gt; 1:             -17 (17 -- -6.3)</span></span>
<span><span class="co">#&gt; 2:             -25 (18 -- -7.7)</span></span>
<span><span class="co">## plot</span></span>
<span><span class="va">region_separate_rt</span><span class="op">$</span><span class="va">summary</span><span class="op">$</span><span class="va">plots</span><span class="op">$</span><span class="va">R</span></span></code></pre></div>
<div class="float">
<img src="epinow-regional_epinow_multiple-1.png" alt="plot of chunk regional_epinow_multiple"><div class="figcaption">plot of chunk regional_epinow_multiple</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://www.samabbott.co.uk/" class="external-link">Sam Abbott</a>, Joel Hellewell, Katharine Sherratt, Katelyn Gostic, Joe Hickson, Hamada S. Badr, Michael DeWitt, James M. Azam, Adrian Lison, <a href="https://www.lshtm.ac.uk/aboutus/people/funk.sebastian" class="external-link">Sebastian Funk</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
