<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Forecasting multiple data streams • EpiNow2</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Forecasting multiple data streams">
<meta name="robots" content="noindex">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">EpiNow2</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">1.8.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/EpiNow2.html">Get started</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-reference" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Reference</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-reference">
<li><a class="dropdown-item" href="../reference/index.html">R Reference</a></li>
    <li><a class="dropdown-item" href="https://epiforecasts.io/EpiNow2/stan/">Stan Reference</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-model-definitions" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Model definitions</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-model-definitions">
<li><a class="dropdown-item" href="../articles/estimate_infections.html">estimate_infections()</a></li>
    <li><a class="dropdown-item" href="../articles/estimate_secondary.html">estimate_secondary()</a></li>
    <li><a class="dropdown-item" href="../articles/estimate_truncation.html">estimate_truncation()</a></li>
    <li><a class="dropdown-item" href="../articles/gaussian_process_implementation_details.html">Gaussian Process implementation details</a></li>
  </ul>
</li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-usage" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Usage</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-usage">
<li><a class="dropdown-item" href="../articles/estimate_infections_workflow.html">Workflow for Rt estimation and forecasting</a></li>
    <li><a class="dropdown-item" href="../articles/prior_choice_guide.html">Prior choice and specification guide</a></li>
    <li><a class="dropdown-item" href="../articles/estimate_infections_options.html">Examples: estimate_infections()</a></li>
    <li><a class="dropdown-item" href="../articles/epinow.html">Using epinow() for running in production mode</a></li>
    <li><a class="dropdown-item" href="../articles/forecasting_multiple_data_streams.html">Forecasting multiple data streams</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-case-studies" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Case studies</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-case-studies">
<li><a class="dropdown-item" href="../articles/case-studies.html">External case studies and use in the literature</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/epiforecasts/EpiNow2/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Forecasting multiple data streams</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/epiforecasts/EpiNow2/blob/main/vignettes/forecasting_multiple_data_streams.Rmd" class="external-link"><code>vignettes/forecasting_multiple_data_streams.Rmd</code></a></small>
      <div class="d-none name"><code>forecasting_multiple_data_streams.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="background">Background<a class="anchor" aria-label="anchor" href="#background"></a>
</h2>
<p>The <code>EpiNow2</code> package contains functionality to make
forecasts for multiple data streams that represent different
epidemiological outcomes. For example, it can be used to predict both
the number of future cases (with symptoms) and severe cases (hospital
admissions). This vignette demonstrates how to do this on an example
simulated data set. For more information on the models used and the
assumptions, look at the methods vignettes for <a href="estimate_infections.html">estimate_infections</a> and <a href="estimate_secondary.html">estimate_secondary</a>.</p>
</div>
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<p>We first load the <em>EpiNow2</em> package. We also load
<code>data.table</code> and <code>ggplot2</code> which we’ll use later
for data manipulation and plotting. Lastly, we set a seed for
reproducibility.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://epiforecasts.io/EpiNow2/">EpiNow2</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'EpiNow2'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Gamma</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">6789</span><span class="op">)</span></span></code></pre></div>
<p>To speed up compuation you can set the number of cores to use. We
will want to run 4 MCMC chains in parallel so if this is available it
would make sense to set:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>mc.cores <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<p>If we had fewer than 4 available or wanted to run fewer than 4 chains
(at the expense of some robustness), or had fewer than 4 computing cores
available we could set it to that. To find out the number of cores
available one can use the <a href="https://rdrr.io/r/parallel/detectCores.html" class="external-link">detectCores</a>
function from the <code>parallel</code> package.</p>
</div>
<div class="section level2">
<h2 id="data">Data<a class="anchor" aria-label="anchor" href="#data"></a>
</h2>
<p>We first simulate a data set that we will use as an example.</p>
<details><summary>
Simulation code
</summary><div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cases</span> <span class="op">&lt;-</span> <span class="va">example_confirmed</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">60</span><span class="op">]</span></span></code></pre></div>
<p>We then generate another data set of hospitalisations, assuming that
10% of confirmed cases become hospitalised with a delay from case
confirmation that is given by a lognormal distribution with mean of 7
days and standard deviation of 3 days.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">admission_delay</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Distributions.html">LogNormal</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fl">7</span>, sd <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">admission_scale</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Distributions.html">Fixed</a></span><span class="op">(</span><span class="fl">0.1</span><span class="op">)</span></span></code></pre></div>
<p>We use the <code>simulate_secondary</code> function to generate a
time series of hospitalisations</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## first, rename the column to what is expected by `simulate_secondary`</span></span>
<span><span class="va">primary</span> <span class="op">&lt;-</span> <span class="va">cases</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">date</span>, primary <span class="op">=</span> <span class="va">confirm</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">## generate hospitalisation data</span></span>
<span><span class="va">hosp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulate_secondary.html">simulate_secondary</a></span><span class="op">(</span></span>
<span>  <span class="va">primary</span>,</span>
<span>  delays <span class="op">=</span> <span class="fu"><a href="../reference/delay_opts.html">delay_opts</a></span><span class="op">(</span><span class="va">admission_delay</span><span class="op">)</span>,</span>
<span>  obs <span class="op">=</span> <span class="fu"><a href="../reference/obs_opts.html">obs_opts</a></span><span class="op">(</span>family <span class="op">=</span> <span class="st">"poisson"</span>, scale <span class="op">=</span> <span class="va">admission_scale</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; ℹ Unconstrained distributon passed as a delay.</span></span>
<span><span class="co">#&gt; ℹ Constraining with default CDF cutoff 0.001.</span></span>
<span><span class="co">#&gt; ℹ To silence this message, specify delay distributions with `max` or</span></span>
<span><span class="co">#&gt;   `default_cdf_cutoff`.</span></span></code></pre></div>
<p>Using this we then create a combined data set:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">primary</span>, <span class="va">hosp</span>, by <span class="op">=</span> <span class="st">"date"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/data.table/man/setattr.html" class="external-link">setnames</a></span><span class="op">(</span></span>
<span>  <span class="va">df</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"date"</span>, <span class="st">"primary"</span>, <span class="st">"secondary"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"date"</span>, <span class="st">"cases"</span>, <span class="st">"hospitalisations"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</details><p>The simulated data set looks like this:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span>
<span><span class="co">#&gt; Key: &lt;date&gt;</span></span>
<span><span class="co">#&gt;          date cases hospitalisations</span></span>
<span><span class="co">#&gt;        &lt;Date&gt; &lt;num&gt;            &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1: 2020-02-22    14                0</span></span>
<span><span class="co">#&gt; 2: 2020-02-23    62                0</span></span>
<span><span class="co">#&gt; 3: 2020-02-24    53                0</span></span>
<span><span class="co">#&gt; 4: 2020-02-25    97                0</span></span>
<span><span class="co">#&gt; 5: 2020-02-26    93                1</span></span>
<span><span class="co">#&gt; 6: 2020-02-27    78                2</span></span>
<span></span>
<span><span class="va">df_long</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/data.table/man/melt.data.table.html" class="external-link">melt</a></span><span class="op">(</span><span class="va">df</span>, id.vars <span class="op">=</span> <span class="st">"date"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">df_long</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">value</span>, colour <span class="op">=</span> <span class="va">variable</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Value"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Date"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="forecasting_multiple_data_streams-show-data-1.png" alt="plot of chunk show-data"><div class="figcaption">plot of chunk show-data</div>
</div>
<div class="section level3">
<h3 id="estimating-infections">Estimating infections<a class="anchor" aria-label="anchor" href="#estimating-infections"></a>
</h3>
<p>We first use one of the two data streams to estimate the number of
infections and make a forecast. Usually this would be done on the
outcome that is closest to infection, in our case the number of
confirmed cases. In order to do so, we would usually specify a number
generation time and any delays to the initial report. This should be
done based on insight on the disease and reporting set up. Here we use
some example parameters, the same as in the <a href="estimate_infections_workflow.html">workflow vignette</a>:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">generation_time</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Distributions.html">Gamma</a></span><span class="op">(</span></span>
<span>  shape <span class="op">=</span> <span class="fu"><a href="../reference/Distributions.html">Normal</a></span><span class="op">(</span><span class="fl">9</span>, <span class="fl">2.5</span><span class="op">)</span>, rate <span class="op">=</span> <span class="fu"><a href="../reference/Distributions.html">Normal</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">1.4</span><span class="op">)</span>, max <span class="op">=</span> <span class="fl">10</span></span>
<span><span class="op">)</span></span>
<span><span class="va">incubation_period</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Distributions.html">LogNormal</a></span><span class="op">(</span></span>
<span>  meanlog <span class="op">=</span> <span class="fu"><a href="../reference/Distributions.html">Normal</a></span><span class="op">(</span><span class="fl">1.6</span>, <span class="fl">0.05</span><span class="op">)</span>,</span>
<span>  sdlog <span class="op">=</span> <span class="fu"><a href="../reference/Distributions.html">Normal</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.05</span><span class="op">)</span>,</span>
<span>  max <span class="op">=</span> <span class="fl">14</span></span>
<span><span class="op">)</span></span>
<span><span class="va">reporting_delay</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Distributions.html">LogNormal</a></span><span class="op">(</span>meanlog <span class="op">=</span> <span class="fl">0.5</span>, sdlog <span class="op">=</span> <span class="fl">0.5</span>, max <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">combined_delays</span> <span class="op">&lt;-</span> <span class="va">incubation_period</span> <span class="op">+</span> <span class="va">reporting_delay</span></span></code></pre></div>
<p>We then estimate infections and produce a 2-week forecast.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">est</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estimate_infections.html">estimate_infections</a></span><span class="op">(</span></span>
<span>  <span class="va">df</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">date</span>, confirm <span class="op">=</span> <span class="va">cases</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  generation_time <span class="op">=</span> <span class="fu"><a href="../reference/generation_time_opts.html">gt_opts</a></span><span class="op">(</span><span class="va">generation_time</span><span class="op">)</span>,</span>
<span>  delay <span class="op">=</span> <span class="fu"><a href="../reference/delay_opts.html">delay_opts</a></span><span class="op">(</span><span class="va">combined_delays</span><span class="op">)</span>,</span>
<span>  forecast <span class="op">=</span> <span class="fu"><a href="../reference/forecast_opts.html">forecast_opts</a></span><span class="op">(</span>horizon <span class="op">=</span> <span class="fl">14</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="estimating-secondary-scaling-and-delay">Estimating secondary scaling and delay<a class="anchor" aria-label="anchor" href="#estimating-secondary-scaling-and-delay"></a>
</h3>
<p>We next use our data sets of cases and admissions to estimate the
delay and scaling between the two (both of which assumed to be constant
over time). This is done using the <code><a href="../reference/estimate_secondary.html">estimate_secondary()</a></code>
function.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estimate_secondary.html">estimate_secondary</a></span><span class="op">(</span></span>
<span>  <span class="va">df</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">date</span>, primary <span class="op">=</span> <span class="va">cases</span>, secondary <span class="op">=</span> <span class="va">hospitalisations</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  obs <span class="op">=</span> <span class="fu"><a href="../reference/obs_opts.html">obs_opts</a></span><span class="op">(</span>scale <span class="op">=</span> <span class="fu"><a href="../reference/Distributions.html">Normal</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="forecasting-secondary-outcomes">Forecasting secondary outcomes<a class="anchor" aria-label="anchor" href="#forecasting-secondary-outcomes"></a>
</h3>
<p>We can now combine our case forecast with the estimated delay and
scaling to make forecasts of the number of hospitalisations. In order to
do so we use the <code>forecast_secondary</code> function.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">forecast</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/forecast_secondary.html">forecast_secondary</a></span><span class="op">(</span></span>
<span>  <span class="va">sec</span>, <span class="va">est</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We can now combine all our forecasts into one plot:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">case_forecast</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/summary.epinow.html">summary</a></span><span class="op">(</span><span class="va">est</span>, type <span class="op">=</span> <span class="st">"parameters"</span><span class="op">)</span><span class="op">[</span></span>
<span>  <span class="va">variable</span> <span class="op">==</span> <span class="st">"reported_cases"</span> <span class="op">&amp;</span> <span class="va">type</span> <span class="op">==</span> <span class="st">"forecast"</span></span>
<span><span class="op">]</span><span class="op">[</span>, <span class="va">variable</span> <span class="op">:=</span> <span class="st">"cases"</span><span class="op">]</span></span>
<span><span class="va">admissions_forecast</span> <span class="op">&lt;-</span> <span class="va">forecast</span><span class="op">$</span><span class="va">predictions</span><span class="op">[</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">secondary</span><span class="op">)</span></span>
<span><span class="op">]</span><span class="op">[</span>, <span class="va">variable</span> <span class="op">:=</span> <span class="st">"hospitalisations"</span><span class="op">]</span></span>
<span><span class="va">forecasts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/data.table/man/rbindlist.html" class="external-link">rbindlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">case_forecast</span>, <span class="va">admissions_forecast</span><span class="op">)</span>, fill <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">df_long</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, colour <span class="op">=</span> <span class="va">variable</span>, fill <span class="op">=</span> <span class="va">variable</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">forecasts</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">lower_20</span>, ymax <span class="op">=</span> <span class="va">upper_20</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>    colour <span class="op">=</span> <span class="cn">NA</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">forecasts</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">lower_50</span>, ymax <span class="op">=</span> <span class="va">upper_50</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>    colour <span class="op">=</span> <span class="cn">NA</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">forecasts</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">lower_90</span>, ymax <span class="op">=</span> <span class="va">upper_90</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>    colour <span class="op">=</span> <span class="cn">NA</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Value"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Date"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="forecasting_multiple_data_streams-combined-plot-1.png" alt="plot of chunk combined-plot"><div class="figcaption">plot of chunk combined-plot</div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://www.samabbott.co.uk/" class="external-link">Sam Abbott</a>, Joel Hellewell, Katharine Sherratt, Katelyn Gostic, Joe Hickson, Hamada S. Badr, Michael DeWitt, James M. Azam, Adrian Lison, <a href="https://www.lshtm.ac.uk/aboutus/people/funk.sebastian" class="external-link">Sebastian Funk</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
