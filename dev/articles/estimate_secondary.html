<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Model definition: estimate_secondary() • EpiNow2</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Model definition: estimate_secondary()">
<meta name="robots" content="noindex">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">EpiNow2</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">1.8.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/EpiNow2.html">Get started</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-reference" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Reference</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-reference">
<li><a class="dropdown-item" href="../reference/index.html">R Reference</a></li>
    <li><a class="dropdown-item" href="https://epiforecasts.io/EpiNow2/stan/">Stan Reference</a></li>
  </ul>
</li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-model-definitions" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Model definitions</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-model-definitions">
<li><a class="dropdown-item" href="../articles/estimate_infections.html">estimate_infections()</a></li>
    <li><a class="dropdown-item" href="../articles/estimate_secondary.html">estimate_secondary()</a></li>
    <li><a class="dropdown-item" href="../articles/estimate_truncation.html">estimate_truncation()</a></li>
    <li><a class="dropdown-item" href="../articles/gaussian_process_implementation_details.html">Gaussian Process implementation details</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-usage" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Usage</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-usage">
<li><a class="dropdown-item" href="../articles/estimate_infections_workflow.html">Workflow for Rt estimation and forecasting</a></li>
    <li><a class="dropdown-item" href="../articles/prior_choice_guide.html">Prior choice and specification guide</a></li>
    <li><a class="dropdown-item" href="../articles/estimate_infections_options.html">Examples: estimate_infections()</a></li>
    <li><a class="dropdown-item" href="../articles/epinow.html">Using epinow() for running in production mode</a></li>
    <li><a class="dropdown-item" href="../articles/forecasting_multiple_data_streams.html">Forecasting multiple data streams</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-case-studies" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Case studies</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-case-studies">
<li><a class="dropdown-item" href="../articles/case-studies.html">External case studies and use in the literature</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/epiforecasts/EpiNow2/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Model definition: estimate_secondary()</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/epiforecasts/EpiNow2/blob/main/vignettes/estimate_secondary.Rmd" class="external-link"><code>vignettes/estimate_secondary.Rmd</code></a></small>
      <div class="d-none name"><code>estimate_secondary.Rmd</code></div>
    </div>

    
    
<p><strong>This is a work in progress. Please consider submitting a PR
to improve it.</strong></p>
<p>This model is based on a discrete convolution of primary cases,
scaled based on the fraction (here described as the secondary fraction
but depending on application potentially being the case fatality ratio,
case hospitalisation ratio, or the hospitalisation fatality ratio), and
a delay distribution that is assumed to follow a discretised daily log
normal distribution. This model can be thought of as a discrete time
ordinary differential equation approximation generalised to log normal,
rather than exponential, delay distributions.</p>
<p>We generalise this simple model beyond the incidence cases to also
include prevalence indicators (for example hospital admissions and
occupancy) where the secondary notifications can be thought of as
depending on secondary notifications from the previous timestep, scaled
current primary notifications, and minus scaled historic primary
notifications weighted by some delay distribution.</p>
<p>This model can be defined as follows,</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover><mi>S</mi><mo accent="true">̂</mo></mover><mi>t</mi></msub><mo>=</mo><msub><mi>δ</mi><mi>p</mi></msub><msub><mi>S</mi><mi>t</mi></msub><mo>+</mo><mi>α</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>δ</mi><mi>p</mi></msub><msub><mi>P</mi><mi>t</mi></msub><mo>+</mo><msub><mi>δ</mi><mi>c</mi></msub><munderover><mo>∑</mo><mrow><mi>τ</mi><mo>=</mo><mn>0</mn></mrow><mi>D</mi></munderover><mi>ξ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>τ</mi><mo stretchy="false" form="prefix">|</mo><mi>μ</mi><mo>,</mo><mi>σ</mi><mo stretchy="true" form="postfix">)</mo></mrow><msub><mi>P</mi><mrow><mi>t</mi><mo>−</mo><mi>τ</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\begin{equation} 
    \hat{S}_{t} = \delta_p S_{t} + \alpha \left( \delta_p P_{t} + \delta_c \sum_{\tau = 0}^{D} \xi(\tau | \mu, \sigma) P_{t-\tau} \right)
\end{equation}</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>S</mi><mi>t</mi></msub><annotation encoding="application/x-tex">S_t</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>P</mi><mi>t</mi></msub><annotation encoding="application/x-tex">P_t</annotation></semantics></math>
are observed primary and secondary notifications,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mover><mi>S</mi><mo accent="true">̂</mo></mover><mi>t</mi></msub><annotation encoding="application/x-tex">\hat{S}_t</annotation></semantics></math>
are expected secondary notifications,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>δ</mi><mi>p</mi></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\delta_p = 1</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>δ</mi><mi>c</mi></msub><mo>=</mo><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\delta_c = -1</annotation></semantics></math>
when
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>S</mi><mi>t</mi></msub><annotation encoding="application/x-tex">S_t</annotation></semantics></math>
is a prevalence measure,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>e</mi><mi>l</mi><mi>t</mi><msub><mi>a</mi><mi>p</mi></msub><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">delta_p = 0</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>δ</mi><mi>c</mi></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\delta_c = 1</annotation></semantics></math>
when it is an incidence based measure.
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ξ</mi><annotation encoding="application/x-tex">\xi</annotation></semantics></math>
are defined as the secondary fraction and delay from primary to
secondary notification (or delay from secondary notification to recovery
etc in the prevalence case) with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>
typically being of most interest to those interpreting the models
posterior estimates. We further assume that
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ξ</mi><annotation encoding="application/x-tex">\xi</annotation></semantics></math>
follows a discretised log normal distribution described by its mean
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>μ</mi><annotation encoding="application/x-tex">\mu</annotation></semantics></math>
and standard deviation
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>σ</mi><annotation encoding="application/x-tex">\sigma</annotation></semantics></math>
on the log scale (where we take the cumulative mass function for time
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>
minus the cumulative mass function for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">t-1</annotation></semantics></math>)
normalised by the maximum allowed delay
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>D</mi><annotation encoding="application/x-tex">D</annotation></semantics></math>
such that
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mo>∑</mo><mrow><mi>τ</mi><mo>=</mo><mn>0</mn></mrow><mi>D</mi></msubsup><mrow><mi>ξ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>τ</mi><mo stretchy="false" form="prefix">|</mo><mi>μ</mi><mo>,</mo><mi>σ</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\sum^D_{\tau=0}{ \xi(\tau | \mu, \sigma)}  = 1</annotation></semantics></math>.</p>
<p>The above definition captures our mechanistic assumptions for the
expectation of secondary notifications but does not account for
potential observation noise or reporting patterns. Here we assume a
negative binomial observation model (though our implementation also
supports a Poisson observation model) in order to capture potential
reporting overdispersion via
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>φ</mi><annotation encoding="application/x-tex">\varphi</annotation></semantics></math>
and adjust expected counts using an optional day of the week effect
based on a simplex
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ω</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mrow><mspace width="0.444em"></mspace><mo>mod</mo><mspace width="0.222em"></mspace><mn>7</mn></mrow><mo stretchy="true" form="postfix">)</mo></mrow></msub><annotation encoding="application/x-tex">\omega_{(t \mod 7)}</annotation></semantics></math>
(such that
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mo>∑</mo><mrow><mi>t</mi><mo>=</mo><mn>0</mn></mrow><mn>6</mn></msubsup><msub><mi>w</mi><mi>t</mi></msub><mo>=</mo><mn>7</mn></mrow><annotation encoding="application/x-tex">\sum^6_{t=0}{w_t} = 7</annotation></semantics></math>
so the total effect over a week is balanced). This gives the following
observation process,</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>S</mi><mi>t</mi></msub><mo>∼</mo><mrow><mi mathvariant="normal">N</mi><mi mathvariant="normal">B</mi></mrow><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>ω</mi><mrow><mi>t</mi><mrow><mspace width="0.444em"></mspace><mo>mod</mo><mspace width="0.222em"></mspace><mn>7</mn></mrow></mrow></msub><msub><mover><mi>S</mi><mo accent="true">̂</mo></mover><mi>t</mi></msub><mo>,</mo><mi>φ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>.</mi></mrow><annotation encoding="application/x-tex">\begin{equation} 
    S_{t} \sim \mathrm{NB}\left(\omega_{t \mod 7} \hat{S}_t,  \varphi \right).
\end{equation}</annotation></semantics></math></p>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://www.samabbott.co.uk/" class="external-link">Sam Abbott</a>, Joel Hellewell, Katharine Sherratt, Katelyn Gostic, Joe Hickson, Hamada S. Badr, Michael DeWitt, James M. Azam, Adrian Lison, <a href="https://www.lshtm.ac.uk/aboutus/people/funk.sebastian" class="external-link">Sebastian Funk</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
