<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Workflow for Rt estimation and forecasting • EpiNow2</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Workflow for Rt estimation and forecasting">
<meta name="robots" content="noindex">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">EpiNow2</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">1.8.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/EpiNow2.html">Get started</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-reference" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Reference</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-reference">
<li><a class="dropdown-item" href="../reference/index.html">R Reference</a></li>
    <li><a class="dropdown-item" href="https://epiforecasts.io/EpiNow2/stan/">Stan Reference</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-model-definitions" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Model definitions</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-model-definitions">
<li><a class="dropdown-item" href="../articles/estimate_infections.html">estimate_infections()</a></li>
    <li><a class="dropdown-item" href="../articles/estimate_secondary.html">estimate_secondary()</a></li>
    <li><a class="dropdown-item" href="../articles/estimate_truncation.html">estimate_truncation()</a></li>
    <li><a class="dropdown-item" href="../articles/gaussian_process_implementation_details.html">Gaussian Process implementation details</a></li>
  </ul>
</li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-usage" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Usage</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-usage">
<li><a class="dropdown-item" href="../articles/estimate_infections_workflow.html">Workflow for Rt estimation and forecasting</a></li>
    <li><a class="dropdown-item" href="../articles/prior_choice_guide.html">Prior choice and specification guide</a></li>
    <li><a class="dropdown-item" href="../articles/estimate_infections_options.html">Examples: estimate_infections()</a></li>
    <li><a class="dropdown-item" href="../articles/epinow.html">Using epinow() for running in production mode</a></li>
    <li><a class="dropdown-item" href="../articles/forecasting_multiple_data_streams.html">Forecasting multiple data streams</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-case-studies" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Case studies</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-case-studies">
<li><a class="dropdown-item" href="../articles/case-studies.html">External case studies and use in the literature</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/epiforecasts/EpiNow2/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Workflow for Rt estimation and forecasting</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/epiforecasts/EpiNow2/blob/main/vignettes/estimate_infections_workflow.Rmd" class="external-link"><code>vignettes/estimate_infections_workflow.Rmd</code></a></small>
      <div class="d-none name"><code>estimate_infections_workflow.Rmd</code></div>
    </div>

    
    
<p>This vignette describes the typical workflow for estimating
reproduction numbers and performing short-term forecasts for a disease
spreading in a given setting using <em>EpiNow2</em>. The vignette uses
the default non-stationary Gaussian process model included in the
package. See other vignettes for a more thorough exploration of <a href="estimate_infections_options.html">alternative model variants</a>
and <a href="estimate_infections.html">theoretical background</a>.</p>
<div class="section level2">
<h2 id="data">Data<a class="anchor" aria-label="anchor" href="#data"></a>
</h2>
<p>Obtaining a good and full understanding of the data being used is an
important first step in any inference procedure such as the one applied
here. <em>EpiNow2</em> expects data in the format of a data frame with
two columns, <code>date</code> and <code>confirm</code>, where
<code>confirm</code> stands for the number of reports - which could be
confirmed case counts although in reality this can be applied to any
data including suspected cases and lab-confirmed outcomes. The user
might already have the data as such a time series provided, for example,
on public dashboards or directly from public health authorities.
Alternatively, they can be constructed from individual-level data, for
example using the <a href="https://CRAN.R-project.org/package=incidence2" class="external-link">incidence2</a> R
package. An example data set called <code>example_confirmed</code> is
included in the package:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu">EpiNow2</span><span class="fu">::</span><span class="va"><a href="../reference/example_confirmed.html">example_confirmed</a></span><span class="op">)</span></span>
<span><span class="co">#&gt;          date confirm</span></span>
<span><span class="co">#&gt;        &lt;Date&gt;   &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1: 2020-02-22      14</span></span>
<span><span class="co">#&gt; 2: 2020-02-23      62</span></span>
<span><span class="co">#&gt; 3: 2020-02-24      53</span></span>
<span><span class="co">#&gt; 4: 2020-02-25      97</span></span>
<span><span class="co">#&gt; 5: 2020-02-26      93</span></span>
<span><span class="co">#&gt; 6: 2020-02-27      78</span></span></code></pre></div>
<p>Any estimation procedure is only as good as the data that feeds into
it. A thorough understanding of the data that is used for
<em>EpiNow2</em> and its limitations is a prerequisite for its use. This
includes but is not limited to biases in the population groups that are
represented (<em>EpiNow2</em> assumes a closed population with all
infections being caused by other infections in the same population),
reporting artefacts and delays, and completeness of reporting. Some of
these can be mitigated using the routines available in <em>EpiNow2</em>
as described below, but others will cause biases in the results and need
to be carefully considered when interpreting the results.</p>
</div>
<div class="section level2">
<h2 id="set-up">Set up<a class="anchor" aria-label="anchor" href="#set-up"></a>
</h2>
<p>We first load the <em>EpiNow2</em> package.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://epiforecasts.io/EpiNow2/">"EpiNow2"</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'EpiNow2'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Gamma</span></span></code></pre></div>
<p>We then set the number of cores to use. We will want to run 4 MCMC
chains in parallel so we set this to 4.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>mc.cores <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<p>If we had fewer than 4 available or wanted to run fewer than 4 chains
(at the expense of some robustness), or had fewer than 4 computing cores
available we could set it to that. To find out the number of cores
available one can use the <a href="https://rdrr.io/r/parallel/detectCores.html" class="external-link">detectCores</a>
function from the <code>parallel</code> package.</p>
</div>
<div class="section level2">
<h2 id="parameters">Parameters<a class="anchor" aria-label="anchor" href="#parameters"></a>
</h2>
<p>Once a data set has been identified, a number of relevant parameters
need to be considered before using <em>EpiNow2</em>. As these will
affect any results, it is worth spending some time investigating what
their values should be.</p>
<div class="section level3">
<h3 id="delay-distributions">Delay distributions<a class="anchor" aria-label="anchor" href="#delay-distributions"></a>
</h3>
<p><em>EpiNow2</em> works with different delays that apply to different
parts of the infection and observation process. They are defined using a
common interface that involves functions that are named after the
probability distributions, i.e. <code><a href="../reference/Distributions.html">LogNormal()</a></code>,
<code><a href="../reference/Distributions.html">Gamma()</a></code>, etc. For help with this function, see its manual
page</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">?</span><span class="fu">EpiNow2</span><span class="fu">::</span><span class="va"><a href="../reference/Distributions.html">Distributions</a></span></span></code></pre></div>
<p>In all cases, the distributions given can be <em>fixed</em>
(i.e. have no uncertainty) or <em>variable</em> (i.e. have associated
uncertainty). For example, to define a fixed gamma distribution with
mean 3, standard deviation (sd) 1 and maximum value 10, you would
write</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fixed_gamma</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Distributions.html">Gamma</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fl">3</span>, sd <span class="op">=</span> <span class="fl">1</span>, max <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">fixed_gamma</span></span>
<span><span class="co">#&gt; - gamma distribution (max: 10):</span></span>
<span><span class="co">#&gt;   shape:</span></span>
<span><span class="co">#&gt;     9</span></span>
<span><span class="co">#&gt;   rate:</span></span>
<span><span class="co">#&gt;     3</span></span></code></pre></div>
<p>which looks like this when plotted</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fixed_gamma</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="estimate_infections_workflow-plot_fixed_gamma-1.png" alt="plot of chunk plot_fixed_gamma"><div class="figcaption">plot of chunk plot_fixed_gamma</div>
</div>
<p>If distributions are variable, the values with uncertainty are
treated as <a href="https://en.wikipedia.org/wiki/Prior_probability" class="external-link">prior probability
densities</a> in the Bayesian inference framework used by
<em>EpiNow2</em>, i.e. they are estimated as part of the inference. For
example, to define a variable gamma distribution where uncertainty in
the shape is given by a normal distribution with mean 3 and sd 2, and
uncertainty in the rate is given by a normal distribution with mean 1
and sd 0.1, with a maximum value 10, you would write</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">uncertain_gamma</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Distributions.html">Gamma</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="fu"><a href="../reference/Distributions.html">Normal</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">2</span><span class="op">)</span>, rate <span class="op">=</span> <span class="fu"><a href="../reference/Distributions.html">Normal</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.1</span><span class="op">)</span>, max <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">uncertain_gamma</span></span>
<span><span class="co">#&gt; - gamma distribution (max: 10):</span></span>
<span><span class="co">#&gt;   shape:</span></span>
<span><span class="co">#&gt;     - normal distribution:</span></span>
<span><span class="co">#&gt;       mean:</span></span>
<span><span class="co">#&gt;         3</span></span>
<span><span class="co">#&gt;       sd:</span></span>
<span><span class="co">#&gt;         2</span></span>
<span><span class="co">#&gt;   rate:</span></span>
<span><span class="co">#&gt;     - normal distribution:</span></span>
<span><span class="co">#&gt;       mean:</span></span>
<span><span class="co">#&gt;         1</span></span>
<span><span class="co">#&gt;       sd:</span></span>
<span><span class="co">#&gt;         0.1</span></span></code></pre></div>
<p>which looks like this when plotted</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">uncertain_gamma</span><span class="op">)</span></span></code></pre></div>
<p><img src="estimate_infections_workflow-plot_uncertain_gamma-1.png" alt="plot of chunk plot_uncertain_gamma"> There are various ways the
specific delay distributions mentioned below might be obtained. Often,
they will come directly from the existing literature reviewed by the
user and studies conducted elsewhere. Sometimes it might be possible to
obtain them from existing databases, e.g. using the <a href="https://github.com/epiverse-trace/epiparameter" class="external-link">epiparameter</a> R
package. Alternatively they might be obtainable from raw data,
e.g. line-listed individual-level records. The <em>EpiNow2</em> package
contains functionality for estimating delay distributions from observed
delays in the <code><a href="../reference/estimate_delay.html">estimate_delay()</a></code> function. For a more
comprehensive treatment of delays and their estimation avoiding common
biases one can also consider the <a href="https://epidist.epinowcast.org/index.html" class="external-link">epidist</a> R
package.</p>
<div class="section level4">
<h4 id="generation-intervals">Generation intervals<a class="anchor" aria-label="anchor" href="#generation-intervals"></a>
</h4>
<p>The generation interval is a delay distribution that describes the
amount of time that passes between an individual becoming infected and
infecting someone else. In <em>EpiNow2</em>, the generation time
distribution is defined by a call to <code><a href="../reference/generation_time_opts.html">gt_opts()</a></code>, a function
that takes a single argument defined as a <code>dist_spec</code> object
(returned by the function corresponding to the probability distribution,
i.e. <code><a href="../reference/Distributions.html">LogNormal()</a></code>, <code><a href="../reference/Distributions.html">Gamma()</a></code>, etc.). For example,
to define the generation time as gamma distributed with uncertain mean
centered on 3 and sd centered on 1 with some uncertainty, a maximum
value of 10 and weighted by the number of case data points we could use
the shape and rate parameters suggested above (though notes that this
will only very approximately produce the uncertainty in mean and
standard deviation stated there):</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">generation_time</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Distributions.html">Gamma</a></span><span class="op">(</span></span>
<span>  shape <span class="op">=</span> <span class="fu"><a href="../reference/Distributions.html">Normal</a></span><span class="op">(</span><span class="fl">9</span>, <span class="fl">2.5</span><span class="op">)</span>, rate <span class="op">=</span> <span class="fu"><a href="../reference/Distributions.html">Normal</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">1.4</span><span class="op">)</span>, max <span class="op">=</span> <span class="fl">10</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/generation_time_opts.html">gt_opts</a></span><span class="op">(</span><span class="va">generation_time</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="reporting-delays">Reporting delays<a class="anchor" aria-label="anchor" href="#reporting-delays"></a>
</h4>
<p><em>EpiNow2</em> calculates reproduction numbers based on the
trajectory of infection incidence. Usually this is not observed
directly. Instead, we calculate case counts based on, for example, onset
of symptoms, lab confirmations, hospitalisations, etc. In order to
estimate the trajectory of infection incidence from this we need to
either know or estimate the distribution of delays from infection to
count. Often, such counts are composed of multiple delays for which we
only have separate information, for example the incubation period (time
from infection to symptom onset) and reporting delay (time from symptom
onset to being a case in the data, e.g. via lab confirmation, if counts
are not by the date of symptom onset). In this case, we can combine
multiple delays with the plus (<code>+</code>) operator, e.g.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">incubation_period</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Distributions.html">LogNormal</a></span><span class="op">(</span></span>
<span>  meanlog <span class="op">=</span> <span class="fu"><a href="../reference/Distributions.html">Normal</a></span><span class="op">(</span><span class="fl">1.6</span>, <span class="fl">0.05</span><span class="op">)</span>,</span>
<span>  sdlog <span class="op">=</span> <span class="fu"><a href="../reference/Distributions.html">Normal</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.05</span><span class="op">)</span>,</span>
<span>  max <span class="op">=</span> <span class="fl">14</span></span>
<span><span class="op">)</span></span>
<span><span class="va">reporting_delay</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Distributions.html">LogNormal</a></span><span class="op">(</span>meanlog <span class="op">=</span> <span class="fl">0.5</span>, sdlog <span class="op">=</span> <span class="fl">0.5</span>, max <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">combined_delays</span> <span class="op">&lt;-</span> <span class="va">incubation_period</span> <span class="op">+</span> <span class="va">reporting_delay</span></span>
<span><span class="va">combined_delays</span></span>
<span><span class="co">#&gt; Composite distribution:</span></span>
<span><span class="co">#&gt; - lognormal distribution (max: 14):</span></span>
<span><span class="co">#&gt;   meanlog:</span></span>
<span><span class="co">#&gt;     - normal distribution:</span></span>
<span><span class="co">#&gt;       mean:</span></span>
<span><span class="co">#&gt;         1.6</span></span>
<span><span class="co">#&gt;       sd:</span></span>
<span><span class="co">#&gt;         0.05</span></span>
<span><span class="co">#&gt;   sdlog:</span></span>
<span><span class="co">#&gt;     - normal distribution:</span></span>
<span><span class="co">#&gt;       mean:</span></span>
<span><span class="co">#&gt;         0.5</span></span>
<span><span class="co">#&gt;       sd:</span></span>
<span><span class="co">#&gt;         0.05</span></span>
<span><span class="co">#&gt; - lognormal distribution (max: 10):</span></span>
<span><span class="co">#&gt;   meanlog:</span></span>
<span><span class="co">#&gt;     0.5</span></span>
<span><span class="co">#&gt;   sdlog:</span></span>
<span><span class="co">#&gt;     0.5</span></span></code></pre></div>
<p>We can visualise this combined delay</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">combined_delays</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="estimate_infections_workflow-plot_combined_delay-1.png" alt="plot of chunk plot_combined_delay"><div class="figcaption">plot of chunk plot_combined_delay</div>
</div>
<p>In <em>EpiNow2</em>, the reporting delay distribution is defined by a
call to <code><a href="../reference/delay_opts.html">delay_opts()</a></code>, a function that takes a single
argument defined as a <code>dist_spec</code> object (returned by
<code><a href="../reference/Distributions.html">LogNormal()</a></code>, <code><a href="../reference/Distributions.html">Gamma()</a></code> etc.). For example, if
our observations were by symptom onset we would use</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/delay_opts.html">delay_opts</a></span><span class="op">(</span><span class="va">incubation_period</span><span class="op">)</span></span></code></pre></div>
<p>If they were by date of lab confirmation that happens with a delay
given by <code>reporting_delay</code>, we would use</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">delay</span> <span class="op">&lt;-</span> <span class="va">incubation_period</span> <span class="op">+</span> <span class="va">reporting_delay</span></span>
<span><span class="fu"><a href="../reference/delay_opts.html">delay_opts</a></span><span class="op">(</span><span class="va">delay</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="truncation">Truncation<a class="anchor" aria-label="anchor" href="#truncation"></a>
</h4>
<p>Besides the delay from infection to the event that is recorded in the
data, there can also be a delay from that event to being recorded in the
data. For example, data reported by symptom onset may only become part
of the dataset once lab confirmation has occurred, or even a day or two
after that confirmation. Statistically, this means our data is
right-truncated. In practice, it means that recent data will be unlikely
to be complete.</p>
<p>The amount of such truncation that exists in the data can be
estimated from multiple snapshots of the data, i.e. what the data looked
like at multiple past dates. One can then use methods that use the
amount of backfilling that occurred 1, 2, … days after data for a date
are first reported. In <em>EpiNow2</em>, this can be done using the
<code><a href="../reference/estimate_truncation.html">estimate_truncation()</a></code> method which returns, amongst others,
posterior estimates of the truncation distribution. For more details on
the model used for this, see the <a href="estimate_truncation.html">estimate_truncation</a> vignette.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">?</span><span class="va">estimate_truncation</span></span></code></pre></div>
<p>In the <code><a href="../reference/estimate_infections.html">estimate_infections()</a></code> function, the truncation
distribution is defined by a call to <code><a href="../reference/trunc_opts.html">trunc_opts()</a></code>, a
function that takes a single argument defined as a
<code>dist_spec</code> (either defined by the user or obtained from a
call to <code><a href="../reference/estimate_truncation.html">estimate_truncation()</a></code> or any other method for
estimating right truncation). This will then be used to correct for
right truncation in the data.</p>
<p>The separation of estimation of right truncation on the one hand and
estimation of the reproduction number on the other may be attractive for
practical purposes but is questionable statistically as it separates two
processes that are not strictly separable, potentially introducing a
bias. An alternative approach where these are estimated jointly is being
implemented in the <a href="https://package.epinowcast.org/" class="external-link">epinowcast</a> package, which is
being developed by the <em>EpiNow2</em> developers with
collaborators.</p>
</div>
</div>
<div class="section level3">
<h3 id="completeness-of-reporting">Completeness of reporting<a class="anchor" aria-label="anchor" href="#completeness-of-reporting"></a>
</h3>
<p>Another issue affecting the progression from infections to reported
outcomes is underreporting, i.e. the fact that not all infections are
reported as cases. This varies both by pathogen and population (and
e.g. the proportion of infections that are asymptomatic) as well as the
specific outcome used as data and where it is located on the severity
pyramid (e.g. hospitalisations vs. community cases). In <em>EpiNow2</em>
we can specify the proportion of infections that we expect to be
observed (with uncertainty assumed represented by a truncated normal
distribution with bounds at 0 and 1) using the <code>scale</code>
argument to the <code><a href="../reference/obs_opts.html">obs_opts()</a></code> function. For example, if we
think that 40% (with standard deviation 1%) of infections end up in the
data as observations we could specify.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">obs_scale</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Distributions.html">Normal</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fl">0.4</span>, sd <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/obs_opts.html">obs_opts</a></span><span class="op">(</span>scale <span class="op">=</span> <span class="va">obs_scale</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="initial-reproduction-number">Initial reproduction number<a class="anchor" aria-label="anchor" href="#initial-reproduction-number"></a>
</h3>
<p>The default model that <code><a href="../reference/estimate_infections.html">estimate_infections()</a></code> uses to
estimate reproduction numbers requires specification of a prior
probability distribution for the initial reproduction number. This
represents the user’s initial belief of the value of the reproduction
number, where there is no data yet to inform its value. By default this
is assumed to be represented by a lognormal distribution with mean and
standard deviation of 1. It can be changed using the
<code><a href="../reference/rt_opts.html">rt_opts()</a></code> function. For example, if the user believes that
at the very start of the data the reproduction number was 2, with
uncertainty in this belief represented by a standard deviation of 1,
they would use</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rt_prior</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Distributions.html">LogNormal</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fl">2</span>, sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/rt_opts.html">rt_opts</a></span><span class="op">(</span>prior <span class="op">=</span> <span class="va">rt_prior</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="weighing-delay-priors">Weighing delay priors<a class="anchor" aria-label="anchor" href="#weighing-delay-priors"></a>
</h3>
<p>When providing uncertain delay distributions one can end up in a
situation where the estimated means are shifted a long way from the
given distribution means, and possibly further than is deemed realistic
by the user. In that case, one could specify narrower prior
distributions (e.g., smaller <code>mean_sd</code>) in order to keep the
estimated means closer to the given mean, but this can be difficult to
do in a principled manner in practice. As a more straightforward
alternative, one can choose to weigh the generation time priors by the
number of data points in the case data set by setting
<code>weigh_delay_priors = TRUE</code> (the default).</p>
</div>
</div>
<div class="section level2">
<h2 id="estimation-and-forecasting">Estimation and forecasting<a class="anchor" aria-label="anchor" href="#estimation-and-forecasting"></a>
</h2>
<p>All the options are combined in a call to the
<code><a href="../reference/estimate_infections.html">estimate_infections()</a></code> function. For example, using some of
the options described above one could call</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">reported_cases</span> <span class="op">&lt;-</span> <span class="va">example_confirmed</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">60</span><span class="op">]</span></span>
<span><span class="va">def</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estimate_infections.html">estimate_infections</a></span><span class="op">(</span></span>
<span>  <span class="va">reported_cases</span>,</span>
<span>  generation_time <span class="op">=</span> <span class="fu"><a href="../reference/generation_time_opts.html">gt_opts</a></span><span class="op">(</span><span class="va">generation_time</span><span class="op">)</span>,</span>
<span>  delays <span class="op">=</span> <span class="fu"><a href="../reference/delay_opts.html">delay_opts</a></span><span class="op">(</span><span class="va">delay</span><span class="op">)</span>,</span>
<span>  rt <span class="op">=</span> <span class="fu"><a href="../reference/rt_opts.html">rt_opts</a></span><span class="op">(</span>prior <span class="op">=</span> <span class="va">rt_prior</span><span class="op">)</span>,</span>
<span>  forecast <span class="op">=</span> <span class="fu"><a href="../reference/forecast_opts.html">forecast_opts</a></span><span class="op">(</span>horizon <span class="op">=</span> <span class="fl">7</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Alternatively, for production environments, we recommend using the
<code><a href="../reference/epinow.html">epinow()</a></code> function. It uses
<code><a href="../reference/estimate_infections.html">estimate_infections()</a></code> internally and provides functionality
for logging and saving results and plots in dedicated directories in the
user’s file system.</p>
<div class="section level3">
<h3 id="forecasting-secondary-outcomes">Forecasting secondary outcomes<a class="anchor" aria-label="anchor" href="#forecasting-secondary-outcomes"></a>
</h3>
<p>The <code><a href="../reference/estimate_infections.html">estimate_infections()</a></code> function works with a single
time series of outcomes such as cases by symptom onset or
hospitalisations. Sometimes one wants to further create forecasts of
other secondary outcomes such as deaths. The package contains
functionality to estimate the delay and scaling between multiple time
series with the <code><a href="../reference/estimate_secondary.html">estimate_secondary()</a></code> function, as well as
for using this to make forecasts with the
<code><a href="../reference/forecast_secondary.html">forecast_secondary()</a></code> function.</p>
</div>
</div>
<div class="section level2">
<h2 id="interpretation">Interpretation<a class="anchor" aria-label="anchor" href="#interpretation"></a>
</h2>
<p>To visualise the results one can use the <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> function
that comes with the package</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">def</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="estimate_infections_workflow-results-1.png" alt="plot of chunk results"><div class="figcaption">plot of chunk results</div>
</div>
<p>The results returned by the <code>estimate_infections</code> model
depend on the values assigned to all to parameters discussed in this
vignette, i.e. delays, scaling, and reproduction numbers, as well as the
model variant used and its parameters. Any interpretation of the results
will therefore need to bear these in mind, as well as any properties of
the data and/or the subpopulations that it represents. See the <a href="estimate_infections_options.html">Model options</a> vignette for
an illustration of the impact of model choice.</p>
<div class="section level3">
<h3 id="evaluating-forecasts-with-scoringutils">Evaluating forecasts with scoringutils<a class="anchor" aria-label="anchor" href="#evaluating-forecasts-with-scoringutils"></a>
</h3>
<p>Forecast evaluation is useful for comparing the predictive
performance of different models or assessing how accuracy changes at
different forecast horizons. The <code><a href="../reference/get_predictions.html">get_predictions()</a></code> function
supports a <code>format = "sample"</code> argument to return raw
posterior samples compatible with the <a href="https://epiforecasts.io/scoringutils/" class="external-link">scoringutils</a>
package.</p>
<p>Since we fitted on only the first 60 days of
<code>example_confirmed</code>, we can score the 7-day forecast against
the full dataset. Here we show forecast scores by horizon:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://doi.org/10.48550/arXiv.2205.07090" class="external-link">scoringutils</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get sample-based predictions for the forecast period</span></span>
<span><span class="va">preds</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_predictions.html">get_predictions</a></span><span class="op">(</span><span class="va">def</span>, format <span class="op">=</span> <span class="st">"sample"</span><span class="op">)</span></span>
<span><span class="va">forecasts</span> <span class="op">&lt;-</span> <span class="va">preds</span><span class="op">[</span><span class="va">horizon</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Add observed data</span></span>
<span><span class="va">forecasts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">forecasts</span>, <span class="va">example_confirmed</span>, by <span class="op">=</span> <span class="st">"date"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Score forecasts by horizon</span></span>
<span><span class="va">forecast_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://epiforecasts.io/scoringutils/reference/as_forecast_sample.html" class="external-link">as_forecast_sample</a></span><span class="op">(</span></span>
<span>  <span class="va">forecasts</span>,</span>
<span>  forecast_unit <span class="op">=</span> <span class="st">"horizon"</span>,</span>
<span>  observed <span class="op">=</span> <span class="st">"confirm"</span>,</span>
<span>  sample_id <span class="op">=</span> <span class="st">"sample"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://epiforecasts.io/scoringutils/reference/score.html" class="external-link">score</a></span><span class="op">(</span><span class="va">forecast_obj</span><span class="op">)</span></span>
<span><span class="co">#&gt;    horizon    bias      dss     crps overprediction underprediction dispersion</span></span>
<span><span class="co">#&gt;      &lt;num&gt;   &lt;num&gt;    &lt;num&gt;    &lt;num&gt;          &lt;num&gt;           &lt;num&gt;      &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:       1 -0.6505 13.31003 305.8814          0.000         190.593   115.2884</span></span>
<span><span class="co">#&gt; 2:       2 -0.8755 15.26973 657.2073          0.000         529.589   127.6183</span></span>
<span><span class="co">#&gt; 3:       3  0.2560 13.38751 190.0780         28.593           0.000   161.4850</span></span>
<span><span class="co">#&gt; 4:       4 -0.5490 13.53322 317.1630          0.000         166.370   150.7930</span></span>
<span><span class="co">#&gt; 5:       5  0.3910 13.79891 254.7470         70.291           0.000   184.4560</span></span>
<span><span class="co">#&gt; 6:       6  0.1640 13.68110 204.2124         12.438           0.000   191.7744</span></span>
<span><span class="co">#&gt; 7:       7  0.4320 13.76404 252.2392         78.715           0.000   173.5242</span></span>
<span><span class="co">#&gt;    log_score      mad ae_median   se_mean</span></span>
<span><span class="co">#&gt;        &lt;num&gt;    &lt;num&gt;     &lt;num&gt;     &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:  7.756721 475.1733     528.5 220416.63</span></span>
<span><span class="co">#&gt; 2:  8.763339 539.6664     990.0 850682.48</span></span>
<span><span class="co">#&gt; 3:  7.476291 688.6677     211.0  87562.73</span></span>
<span><span class="co">#&gt; 4:  7.945295 643.4484     543.0 203621.15</span></span>
<span><span class="co">#&gt; 5:  7.620958 768.7281     354.5 224057.86</span></span>
<span><span class="co">#&gt; 6:  7.573535 795.4149     146.5  89926.22</span></span>
<span><span class="co">#&gt; 7:  7.522562 733.8870     363.5 246446.22</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://www.samabbott.co.uk/" class="external-link">Sam Abbott</a>, Joel Hellewell, Katharine Sherratt, Katelyn Gostic, Joe Hickson, Hamada S. Badr, Michael DeWitt, James M. Azam, Adrian Lison, <a href="https://www.lshtm.ac.uk/aboutus/people/funk.sebastian" class="external-link">Sebastian Funk</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
