<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Estimate a Secondary Observation from a Primary Observation — estimate_secondary • EpiNow2</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Estimate a Secondary Observation from a Primary Observation — estimate_secondary"><meta name="description" content="
Estimates the relationship between a primary and secondary observation, for
example hospital admissions and deaths or hospital admissions and bed
occupancy. See secondary_opts() for model structure options. See parameter
documentation for model defaults and options. See the examples for case
studies using synthetic data and
here
for an example of forecasting Covid-19 deaths from Covid-19 cases. See
here for
a prototype function that may be used to estimate and forecast a secondary
observation from a primary across multiple regions and
here # nolint
for an application forecasting Covid-19 deaths in Germany and Poland."><meta property="og:description" content="
Estimates the relationship between a primary and secondary observation, for
example hospital admissions and deaths or hospital admissions and bed
occupancy. See secondary_opts() for model structure options. See parameter
documentation for model defaults and options. See the examples for case
studies using synthetic data and
here
for an example of forecasting Covid-19 deaths from Covid-19 cases. See
here for
a prototype function that may be used to estimate and forecast a secondary
observation from a primary across multiple regions and
here # nolint
for an application forecasting Covid-19 deaths in Germany and Poland."><meta property="og:image" content="https://epiforecasts.io/EpiNow2/reference/figures/unnamed-chunk-14-1.png"><meta property="og:image:alt" content="Example estimates produced by EpiNow2 of the reproduction number, cases by date of infection and cases by date of report"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:creator" content="@seabbs"><meta name="twitter:site" content="@epiforecasts"><meta name="robots" content="noindex"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">EpiNow2</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">1.8.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/EpiNow2.html">Get started</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-reference" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Reference</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-reference"><li><a class="dropdown-item" href="../reference/index.html">R Reference</a></li>
    <li><a class="dropdown-item" href="https://epiforecasts.io/EpiNow2/stan/">Stan Reference</a></li>
  </ul></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-model-definitions" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Model definitions</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-model-definitions"><li><a class="dropdown-item" href="../articles/estimate_infections.html">estimate_infections()</a></li>
    <li><a class="dropdown-item" href="../articles/estimate_secondary.html">estimate_secondary()</a></li>
    <li><a class="dropdown-item" href="../articles/estimate_truncation.html">estimate_truncation()</a></li>
    <li><a class="dropdown-item" href="../articles/gaussian_process_implementation_details.html">Gaussian Process implementation details</a></li>
  </ul></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-usage" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Usage</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-usage"><li><a class="dropdown-item" href="../articles/estimate_infections_workflow.html">Workflow for Rt estimation and forecasting</a></li>
    <li><a class="dropdown-item" href="../articles/prior_choice_guide.html">Prior choice and specification guide</a></li>
    <li><a class="dropdown-item" href="../articles/estimate_infections_options.html">Examples: estimate_infections()</a></li>
    <li><a class="dropdown-item" href="../articles/epinow.html">Using epinow() for running in production mode</a></li>
    <li><a class="dropdown-item" href="../articles/forecasting_multiple_data_streams.html">Forecasting multiple data streams</a></li>
  </ul></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-case-studies" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Case studies</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-case-studies"><li><a class="dropdown-item" href="../articles/case-studies.html">External case studies and use in the literature</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/epiforecasts/EpiNow2/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Estimate a Secondary Observation from a Primary Observation</h1>
      <small class="dont-index">Source: <a href="https://github.com/epiforecasts/EpiNow2/blob/main/R/estimate_secondary.R" class="external-link"><code>R/estimate_secondary.R</code></a></small>
      <div class="d-none name"><code>estimate_secondary.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable" class="external-link"><img src="figures/lifecycle-stable.svg" alt="[Stable]"></a>
Estimates the relationship between a primary and secondary observation, for
example hospital admissions and deaths or hospital admissions and bed
occupancy. See <code><a href="secondary_opts.html">secondary_opts()</a></code> for model structure options. See parameter
documentation for model defaults and options. See the examples for case
studies using synthetic data and
<a href="https://gist.github.com/seabbs/4f09d7609df298db7a86c31612ff9d17" class="external-link">here</a>
for an example of forecasting Covid-19 deaths from Covid-19 cases. See
<a href="https://gist.github.com/seabbs/4dad3958ca8d83daca8f02b143d152e6" class="external-link">here</a> for
a prototype function that may be used to estimate and forecast a secondary
observation from a primary across multiple regions and
<a href="https://github.com/epiforecasts/covid.german.forecasts/blob/master/rt-forecast/death-from-cases.R" class="external-link">here</a> # nolint
for an application forecasting Covid-19 deaths in Germany and Poland.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">estimate_secondary</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  secondary <span class="op">=</span> <span class="fu"><a href="secondary_opts.html">secondary_opts</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  delays <span class="op">=</span> <span class="fu"><a href="delay_opts.html">delay_opts</a></span><span class="op">(</span><span class="fu"><a href="Distributions.html">LogNormal</a></span><span class="op">(</span>meanlog <span class="op">=</span> <span class="fu"><a href="Distributions.html">Normal</a></span><span class="op">(</span><span class="fl">2.5</span>, <span class="fl">0.5</span><span class="op">)</span>, sdlog <span class="op">=</span> <span class="fu"><a href="Distributions.html">Normal</a></span><span class="op">(</span><span class="fl">0.47</span>, <span class="fl">0.25</span><span class="op">)</span>,</span>
<span>    max <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>, weight_prior <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>  truncation <span class="op">=</span> <span class="fu"><a href="trunc_opts.html">trunc_opts</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  obs <span class="op">=</span> <span class="fu"><a href="obs_opts.html">obs_opts</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  stan <span class="op">=</span> <span class="fu"><a href="stan_opts.html">stan_opts</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  burn_in <span class="op">=</span> <span class="fl">14</span>,</span>
<span>  CrIs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.5</span>, <span class="fl">0.9</span><span class="op">)</span>,</span>
<span>  priors <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  model <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  weigh_delay_priors <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/interactive.html" class="external-link">interactive</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>A <code>&lt;data.frame&gt;</code> containing the <code>date</code> of report and both
<code>primary</code> and <code>secondary</code> reports. Optionally this can also have a logical
<code>accumulate</code> column which indicates whether data should be added to the
next data point. This is useful when modelling e.g. weekly incidence data.
See also the <code><a href="fill_missing.html">fill_missing()</a></code> function which helps add the <code>accumulate</code>
column with the desired properties when dealing with non-daily data. If any
accumulation is done this happens after truncation as specified by the
<code>truncation</code> argument.</p></dd>


<dt id="arg-secondary">secondary<a class="anchor" aria-label="anchor" href="#arg-secondary"></a></dt>
<dd><p>A call to <code><a href="secondary_opts.html">secondary_opts()</a></code> or a list containing the
following  binary variables: cumulative, historic, primary_hist_additive,
current, primary_current_additive. These parameters control the structure of
the secondary model, see <code><a href="secondary_opts.html">secondary_opts()</a></code> for details.</p></dd>


<dt id="arg-delays">delays<a class="anchor" aria-label="anchor" href="#arg-delays"></a></dt>
<dd><p>A call to <code><a href="delay_opts.html">delay_opts()</a></code> defining delay distributions between
primary and secondary observations See the documentation of <code><a href="delay_opts.html">delay_opts()</a></code>
for details. By default a diffuse prior  is assumed with a mean of 14 days
and standard deviation of 7 days (with a standard deviation of 0.5 and 0.25
respectively on the log scale).</p></dd>


<dt id="arg-truncation">truncation<a class="anchor" aria-label="anchor" href="#arg-truncation"></a></dt>
<dd><p>A call to <code><a href="trunc_opts.html">trunc_opts()</a></code> defining the truncation of
the observed data. Defaults to <code><a href="trunc_opts.html">trunc_opts()</a></code>, i.e. no truncation.  See the
<code><a href="estimate_truncation.html">estimate_truncation()</a></code> help file for an approach to estimating this from
data where the <code>dist</code> list element returned by <code><a href="estimate_truncation.html">estimate_truncation()</a></code> is
used as the <code>truncation</code> argument here, thereby propagating the uncertainty
in the estimate.</p></dd>


<dt id="arg-obs">obs<a class="anchor" aria-label="anchor" href="#arg-obs"></a></dt>
<dd><p>A list of options as generated by <code><a href="obs_opts.html">obs_opts()</a></code> defining the
observation model. Defaults to <code><a href="obs_opts.html">obs_opts()</a></code>.</p></dd>


<dt id="arg-stan">stan<a class="anchor" aria-label="anchor" href="#arg-stan"></a></dt>
<dd><p>A list of stan options as generated by <code><a href="stan_opts.html">stan_opts()</a></code>. Defaults
to <code><a href="stan_opts.html">stan_opts()</a></code>. Can be used to override <code>data</code>, <code>init</code>, and <code>verbose</code>
settings if desired.</p></dd>


<dt id="arg-burn-in">burn_in<a class="anchor" aria-label="anchor" href="#arg-burn-in"></a></dt>
<dd><p>Integer, defaults to 14 days. The number of data points to
use for estimation but not to fit to at the beginning of the time series.
This must be less than the number of observations.</p></dd>


<dt id="arg-cris">CrIs<a class="anchor" aria-label="anchor" href="#arg-cris"></a></dt>
<dd><p>Numeric vector of credible intervals to calculate.</p></dd>


<dt id="arg-priors">priors<a class="anchor" aria-label="anchor" href="#arg-priors"></a></dt>
<dd><p>A <code>&lt;data.frame&gt;</code> of named priors to be used in model fitting
rather than the defaults supplied from other arguments. This is typically
useful if wanting to inform an estimate from the posterior of another model
fit.</p></dd>


<dt id="arg-model">model<a class="anchor" aria-label="anchor" href="#arg-model"></a></dt>
<dd><p>A compiled stan model to override the default model. May be
useful for package developers or those developing extensions.</p></dd>


<dt id="arg-weigh-delay-priors">weigh_delay_priors<a class="anchor" aria-label="anchor" href="#arg-weigh-delay-priors"></a></dt>
<dd><p>Logical. If TRUE, all delay distribution priors
will be weighted by the number of observation data points, in doing so
approximately placing an independent prior at each time step and usually
preventing the posteriors from shifting. If FALSE (default), no weight will
be applied, i.e. delay distributions will be treated as a single
parameters.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>Logical, should model fitting progress be returned. Defaults
to <code><a href="https://rdrr.io/r/base/interactive.html" class="external-link">interactive()</a></code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>An <code>&lt;estimate_secondary&gt;</code> object containing:</p><ul><li><p><code>fit</code>: The stan fit object.</p></li>
<li><p><code>args</code>: A list of arguments used for fitting (stan data).</p></li>
<li><p><code>observations</code>: The input data (<code>&lt;data.frame&gt;</code>).</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="get_samples.html">get_samples()</a></code> <code><a href="get_predictions.html">get_predictions()</a></code> <code><a href="get_parameters.html">get_parameters()</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="co"># set number of cores to use</span></span></span>
<span class="r-in"><span><span class="va">old_opts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>mc.cores <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/interactive.html" class="external-link">interactive</a></span><span class="op">(</span><span class="op">)</span>, <span class="fl">4</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># load data.table for manipulation</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#### Incidence data example ####</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># make some example secondary incidence data</span></span></span>
<span class="r-in"><span><span class="va">cases</span> <span class="op">&lt;-</span> <span class="va">example_confirmed</span></span></span>
<span class="r-in"><span><span class="va">cases</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/data.table/man/as.data.table.html" class="external-link">as.data.table</a></span><span class="op">(</span><span class="va">cases</span><span class="op">)</span><span class="op">[</span>, <span class="va">primary</span> <span class="op">:=</span> <span class="va">confirm</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="co"># Assume that only 40 percent of cases are reported</span></span></span>
<span class="r-in"><span><span class="va">cases</span><span class="op">[</span>, <span class="va">scaling</span> <span class="op">:=</span> <span class="fl">0.4</span><span class="op">]</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            date confirm primary scaling</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          &lt;Date&gt;   &lt;num&gt;   &lt;num&gt;   &lt;num&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   1: 2020-02-22      14      14     0.4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   2: 2020-02-23      62      62     0.4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   3: 2020-02-24      53      53     0.4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   4: 2020-02-25      97      97     0.4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   5: 2020-02-26      93      93     0.4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  ---                                   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 126: 2020-06-26     296     296     0.4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 127: 2020-06-27     255     255     0.4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 128: 2020-06-28     175     175     0.4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 129: 2020-06-29     174     174     0.4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 130: 2020-06-30     126     126     0.4</span>
<span class="r-in"><span><span class="co"># Parameters of the assumed log normal delay distribution</span></span></span>
<span class="r-in"><span><span class="va">cases</span><span class="op">[</span>, <span class="va">meanlog</span> <span class="op">:=</span> <span class="fl">1.8</span><span class="op">]</span><span class="op">[</span>, <span class="va">sdlog</span> <span class="op">:=</span> <span class="fl">0.5</span><span class="op">]</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            date confirm primary scaling meanlog sdlog</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          &lt;Date&gt;   &lt;num&gt;   &lt;num&gt;   &lt;num&gt;   &lt;num&gt; &lt;num&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   1: 2020-02-22      14      14     0.4     1.8   0.5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   2: 2020-02-23      62      62     0.4     1.8   0.5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   3: 2020-02-24      53      53     0.4     1.8   0.5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   4: 2020-02-25      97      97     0.4     1.8   0.5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   5: 2020-02-26      93      93     0.4     1.8   0.5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  ---                                                 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 126: 2020-06-26     296     296     0.4     1.8   0.5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 127: 2020-06-27     255     255     0.4     1.8   0.5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 128: 2020-06-28     175     175     0.4     1.8   0.5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 129: 2020-06-29     174     174     0.4     1.8   0.5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 130: 2020-06-30     126     126     0.4     1.8   0.5</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Simulate secondary cases</span></span></span>
<span class="r-in"><span><span class="va">cases</span> <span class="op">&lt;-</span> <span class="fu"><a href="convolve_and_scale.html">convolve_and_scale</a></span><span class="op">(</span><span class="va">cases</span>, type <span class="op">=</span> <span class="st">"incidence"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># fit model to example data specifying a weak prior for fraction reported</span></span></span>
<span class="r-in"><span><span class="co"># with a secondary case</span></span></span>
<span class="r-in"><span><span class="va">inc</span> <span class="op">&lt;-</span> <span class="fu">estimate_secondary</span><span class="op">(</span><span class="va">cases</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">60</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>  obs <span class="op">=</span> <span class="fu"><a href="obs_opts.html">obs_opts</a></span><span class="op">(</span>scale <span class="op">=</span> <span class="fu"><a href="Distributions.html">Normal</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fl">0.2</span>, sd <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span>, week_effect <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">inc</span>, primary <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Removed 14 rows containing missing values or values outside the scale range</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> (`geom_ribbon()`).</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Removed 14 rows containing missing values or values outside the scale range</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> (`geom_ribbon()`).</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Removed 14 rows containing missing values or values outside the scale range</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> (`geom_ribbon()`).</span>
<span class="r-plt img"><img src="estimate_secondary-1.png" alt="" width="864" height="864"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># forecast future secondary cases from primary</span></span></span>
<span class="r-in"><span><span class="va">inc_preds</span> <span class="op">&lt;-</span> <span class="fu"><a href="forecast_secondary.html">forecast_secondary</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">inc</span>, <span class="va">cases</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">61</span>, <span class="va">.N</span><span class="op">)</span><span class="op">]</span><span class="op">[</span>, <span class="va">value</span> <span class="op">:=</span> <span class="va">primary</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">inc_preds</span>, new_obs <span class="op">=</span> <span class="va">cases</span>, from <span class="op">=</span> <span class="st">"2020-05-01"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="estimate_secondary-2.png" alt="" width="864" height="864"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#### Prevalence data example ####</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># make some example prevalence data</span></span></span>
<span class="r-in"><span><span class="va">cases</span> <span class="op">&lt;-</span> <span class="va">example_confirmed</span></span></span>
<span class="r-in"><span><span class="va">cases</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/data.table/man/as.data.table.html" class="external-link">as.data.table</a></span><span class="op">(</span><span class="va">cases</span><span class="op">)</span><span class="op">[</span>, <span class="va">primary</span> <span class="op">:=</span> <span class="va">confirm</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="co"># Assume that only 30 percent of cases are reported</span></span></span>
<span class="r-in"><span><span class="va">cases</span><span class="op">[</span>, <span class="va">scaling</span> <span class="op">:=</span> <span class="fl">0.3</span><span class="op">]</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            date confirm primary scaling</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          &lt;Date&gt;   &lt;num&gt;   &lt;num&gt;   &lt;num&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   1: 2020-02-22      14      14     0.3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   2: 2020-02-23      62      62     0.3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   3: 2020-02-24      53      53     0.3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   4: 2020-02-25      97      97     0.3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   5: 2020-02-26      93      93     0.3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  ---                                   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 126: 2020-06-26     296     296     0.3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 127: 2020-06-27     255     255     0.3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 128: 2020-06-28     175     175     0.3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 129: 2020-06-29     174     174     0.3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 130: 2020-06-30     126     126     0.3</span>
<span class="r-in"><span><span class="co"># Parameters of the assumed log normal delay distribution</span></span></span>
<span class="r-in"><span><span class="va">cases</span><span class="op">[</span>, <span class="va">meanlog</span> <span class="op">:=</span> <span class="fl">1.6</span><span class="op">]</span><span class="op">[</span>, <span class="va">sdlog</span> <span class="op">:=</span> <span class="fl">0.8</span><span class="op">]</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            date confirm primary scaling meanlog sdlog</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          &lt;Date&gt;   &lt;num&gt;   &lt;num&gt;   &lt;num&gt;   &lt;num&gt; &lt;num&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   1: 2020-02-22      14      14     0.3     1.6   0.8</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   2: 2020-02-23      62      62     0.3     1.6   0.8</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   3: 2020-02-24      53      53     0.3     1.6   0.8</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   4: 2020-02-25      97      97     0.3     1.6   0.8</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   5: 2020-02-26      93      93     0.3     1.6   0.8</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  ---                                                 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 126: 2020-06-26     296     296     0.3     1.6   0.8</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 127: 2020-06-27     255     255     0.3     1.6   0.8</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 128: 2020-06-28     175     175     0.3     1.6   0.8</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 129: 2020-06-29     174     174     0.3     1.6   0.8</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 130: 2020-06-30     126     126     0.3     1.6   0.8</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Simulate secondary cases</span></span></span>
<span class="r-in"><span><span class="va">cases</span> <span class="op">&lt;-</span> <span class="fu"><a href="convolve_and_scale.html">convolve_and_scale</a></span><span class="op">(</span><span class="va">cases</span>, type <span class="op">=</span> <span class="st">"prevalence"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># fit model to example prevalence data</span></span></span>
<span class="r-in"><span><span class="va">prev</span> <span class="op">&lt;-</span> <span class="fu">estimate_secondary</span><span class="op">(</span><span class="va">cases</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>  secondary <span class="op">=</span> <span class="fu"><a href="secondary_opts.html">secondary_opts</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"prevalence"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  obs <span class="op">=</span> <span class="fu"><a href="obs_opts.html">obs_opts</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    week_effect <span class="op">=</span> <span class="cn">FALSE</span>,</span></span>
<span class="r-in"><span>    scale <span class="op">=</span> <span class="fu"><a href="Distributions.html">Normal</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fl">0.4</span>, sd <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">prev</span>, primary <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Removed 14 rows containing missing values or values outside the scale range</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> (`geom_ribbon()`).</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Removed 14 rows containing missing values or values outside the scale range</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> (`geom_ribbon()`).</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Removed 14 rows containing missing values or values outside the scale range</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> (`geom_ribbon()`).</span>
<span class="r-plt img"><img src="estimate_secondary-3.png" alt="" width="864" height="864"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># forecast future secondary cases from primary</span></span></span>
<span class="r-in"><span><span class="va">prev_preds</span> <span class="op">&lt;-</span> <span class="fu"><a href="forecast_secondary.html">forecast_secondary</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">prev</span>, <span class="va">cases</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">101</span>, <span class="va">.N</span><span class="op">)</span><span class="op">]</span><span class="op">[</span>, <span class="va">value</span> <span class="op">:=</span> <span class="va">primary</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">prev_preds</span>, new_obs <span class="op">=</span> <span class="va">cases</span>, from <span class="op">=</span> <span class="st">"2020-06-01"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="estimate_secondary-4.png" alt="" width="864" height="864"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span><span class="va">old_opts</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://www.samabbott.co.uk/" class="external-link">Sam Abbott</a>, Joel Hellewell, Katharine Sherratt, Katelyn Gostic, Joe Hickson, Hamada S. Badr, Michael DeWitt, James M. Azam, Adrian Lison, <a href="https://www.lshtm.ac.uk/aboutus/people/funk.sebastian" class="external-link">Sebastian Funk</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

