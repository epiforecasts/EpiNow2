<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Examples: estimate_infections() • EpiNow2</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Examples: estimate_infections()">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">EpiNow2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.8.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/EpiNow2.html">Get started</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-reference" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Reference</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-reference">
<li><a class="dropdown-item" href="../reference/index.html">R Reference</a></li>
    <li><a class="dropdown-item" href="https://epiforecasts.io/EpiNow2/stan/">Stan Reference</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-model-definitions" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Model definitions</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-model-definitions">
<li><a class="dropdown-item" href="../articles/estimate_infections.html">estimate_infections()</a></li>
    <li><a class="dropdown-item" href="../articles/estimate_secondary.html">estimate_secondary()</a></li>
    <li><a class="dropdown-item" href="../articles/estimate_truncation.html">estimate_truncation()</a></li>
    <li><a class="dropdown-item" href="../articles/gaussian_process_implementation_details.html">Gaussian Process implementation details</a></li>
  </ul>
</li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-usage" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Usage</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-usage">
<li><a class="dropdown-item" href="../articles/estimate_infections_workflow.html">Workflow for Rt estimation and forecasting</a></li>
    <li><a class="dropdown-item" href="../articles/prior_choice_guide.html">Prior choice and specification guide</a></li>
    <li><a class="dropdown-item" href="../articles/estimate_infections_options.html">Examples: estimate_infections()</a></li>
    <li><a class="dropdown-item" href="../articles/epinow.html">Using epinow() for running in production mode</a></li>
    <li><a class="dropdown-item" href="../articles/forecasting_multiple_data_streams.html">Forecasting multiple data streams</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-case-studies" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Case studies</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-case-studies">
<li><a class="dropdown-item" href="../articles/case-studies.html">External case studies and use in the literature</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/epiforecasts/EpiNow2/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Examples: estimate_infections()</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/epiforecasts/EpiNow2/blob/v1.8.0/vignettes/estimate_infections_options.Rmd" class="external-link"><code>vignettes/estimate_infections_options.Rmd</code></a></small>
      <div class="d-none name"><code>estimate_infections_options.Rmd</code></div>
    </div>

    
    
<p>The <code><a href="../reference/estimate_infections.html">estimate_infections()</a></code> function encodes a range of
different model options. In this vignette we apply some of these to the
example data provided with the <em>EpiNow2</em> package, highlighting
differences in inference results and run times. It is not meant as a
comprehensive exploration of all the functionality in the package, but
intended to give users a flavour of the kind of model options that exist
for reproduction number estimation and forecasting within the package,
and the differences in computational speed between them. For
mathematical detail on the model please consult the <a href="estimate_infections.html">model definition</a> vignette, and for a
more general description of the use of the function, the <a href="estimate_infections_workflow.html">estimate_infections
workflow</a> vignette.</p>
<div class="section level2">
<h2 id="set-up">Set up<a class="anchor" aria-label="anchor" href="#set-up"></a>
</h2>
<p>We first load the <em>EpiNow2</em> package and also the
<em>rstan</em> package that we will use later to show the differences in
run times between different model options.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://epiforecasts.io/EpiNow2/">"EpiNow2"</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'EpiNow2'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Gamma</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://mc-stan.org/rstan/" class="external-link">"rstan"</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: StanHeaders</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; rstan version 2.32.7 (Stan version 2.32.2)</span></span>
<span><span class="co">#&gt; For execution on a local, multicore CPU with excess RAM we recommend calling</span></span>
<span><span class="co">#&gt; options(mc.cores = parallel::detectCores()).</span></span>
<span><span class="co">#&gt; To avoid recompilation of unchanged Stan programs, we recommend calling</span></span>
<span><span class="co">#&gt; rstan_options(auto_write = TRUE)</span></span>
<span><span class="co">#&gt; For within-chain threading using `reduce_sum()` or `map_rect()` Stan functions,</span></span>
<span><span class="co">#&gt; change `threads_per_chain` option:</span></span>
<span><span class="co">#&gt; rstan_options(threads_per_chain = 1)</span></span></code></pre></div>
<p>In this examples we set the number of cores to use to 4 but the
optimal value here will depend on the computing resources available.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>mc.cores <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="data">Data<a class="anchor" aria-label="anchor" href="#data"></a>
</h2>
<p>We will use an example data set that is included in the package,
representing an outbreak of COVID-19 with an initial rapid increase
followed by decreasing incidence.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://ggplot2.tidyverse.org" class="external-link">"ggplot2"</a></span><span class="op">)</span></span>
<span><span class="va">reported_cases</span> <span class="op">&lt;-</span> <span class="va">example_confirmed</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">60</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">reported_cases</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span>  <span class="va">date</span>, y <span class="op">=</span> <span class="va">confirm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_col</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Date"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Cases"</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="estimate_infections_options-data-1.png" alt="plot of chunk data"><div class="figcaption">plot of chunk data</div>
</div>
</div>
<div class="section level2">
<h2 id="parameters">Parameters<a class="anchor" aria-label="anchor" href="#parameters"></a>
</h2>
<p>Before running the model we need to decide on some parameter values,
in particular any delays, the generation time, and a prior on the
initial reproduction number.</p>
<div class="section level3">
<h3 id="delays-incubation-period-and-reporting-delay">Delays: incubation period and reporting delay<a class="anchor" aria-label="anchor" href="#delays-incubation-period-and-reporting-delay"></a>
</h3>
<p>Delays reflect the time that passes between infection and reporting,
if these exist. In this example, we assume two delays, an <em>incubation
period</em> (i.e. delay from infection to symptom onset) and a
<em>reporting delay</em> (i.e. the delay from symptom onset to being
recorded as a symptomatic case). These delays are usually not the same
for everyone and are instead characterised by a distribution. For the
incubation period we use an example from the literature that is included
in the package.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">example_incubation_period</span></span>
<span><span class="co">#&gt; - lognormal distribution (max: 14):</span></span>
<span><span class="co">#&gt;   meanlog:</span></span>
<span><span class="co">#&gt;     - normal distribution:</span></span>
<span><span class="co">#&gt;       mean:</span></span>
<span><span class="co">#&gt;         1.6</span></span>
<span><span class="co">#&gt;       sd:</span></span>
<span><span class="co">#&gt;         0.064</span></span>
<span><span class="co">#&gt;   sdlog:</span></span>
<span><span class="co">#&gt;     - normal distribution:</span></span>
<span><span class="co">#&gt;       mean:</span></span>
<span><span class="co">#&gt;         0.42</span></span>
<span><span class="co">#&gt;       sd:</span></span>
<span><span class="co">#&gt;         0.069</span></span></code></pre></div>
<p>For the reporting delay, we use a lognormal distribution with mean of
2 days and standard deviation of 1 day. Note that the mean and standard
deviation must be converted to the log scale, which can be done using
the <code>convert_log_logmean()</code> function.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">reporting_delay</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Distributions.html">LogNormal</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fl">2</span>, sd <span class="op">=</span> <span class="fl">1</span>, max <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">reporting_delay</span></span>
<span><span class="co">#&gt; - lognormal distribution (max: 10):</span></span>
<span><span class="co">#&gt;   meanlog:</span></span>
<span><span class="co">#&gt;     0.58</span></span>
<span><span class="co">#&gt;   sdlog:</span></span>
<span><span class="co">#&gt;     0.47</span></span></code></pre></div>
<p><em>EpiNow2</em> provides a feature that allows us to combine these
delays into one by summing them up</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">delay</span> <span class="op">&lt;-</span> <span class="va">example_incubation_period</span> <span class="op">+</span> <span class="va">reporting_delay</span></span>
<span><span class="va">delay</span></span>
<span><span class="co">#&gt; Composite distribution:</span></span>
<span><span class="co">#&gt; - lognormal distribution (max: 14):</span></span>
<span><span class="co">#&gt;   meanlog:</span></span>
<span><span class="co">#&gt;     - normal distribution:</span></span>
<span><span class="co">#&gt;       mean:</span></span>
<span><span class="co">#&gt;         1.6</span></span>
<span><span class="co">#&gt;       sd:</span></span>
<span><span class="co">#&gt;         0.064</span></span>
<span><span class="co">#&gt;   sdlog:</span></span>
<span><span class="co">#&gt;     - normal distribution:</span></span>
<span><span class="co">#&gt;       mean:</span></span>
<span><span class="co">#&gt;         0.42</span></span>
<span><span class="co">#&gt;       sd:</span></span>
<span><span class="co">#&gt;         0.069</span></span>
<span><span class="co">#&gt; - lognormal distribution (max: 10):</span></span>
<span><span class="co">#&gt;   meanlog:</span></span>
<span><span class="co">#&gt;     0.58</span></span>
<span><span class="co">#&gt;   sdlog:</span></span>
<span><span class="co">#&gt;     0.47</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="generation-time">Generation time<a class="anchor" aria-label="anchor" href="#generation-time"></a>
</h3>
<p>If we want to estimate the reproduction number we need to provide a
distribution of generation times. Here again we use an example from the
literature that is included with the package.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">example_generation_time</span></span>
<span><span class="co">#&gt; - gamma distribution (max: 14):</span></span>
<span><span class="co">#&gt;   shape:</span></span>
<span><span class="co">#&gt;     - normal distribution:</span></span>
<span><span class="co">#&gt;       mean:</span></span>
<span><span class="co">#&gt;         1.4</span></span>
<span><span class="co">#&gt;       sd:</span></span>
<span><span class="co">#&gt;         0.48</span></span>
<span><span class="co">#&gt;   rate:</span></span>
<span><span class="co">#&gt;     - normal distribution:</span></span>
<span><span class="co">#&gt;       mean:</span></span>
<span><span class="co">#&gt;         0.38</span></span>
<span><span class="co">#&gt;       sd:</span></span>
<span><span class="co">#&gt;         0.25</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="initial-reproduction-number">Initial reproduction number<a class="anchor" aria-label="anchor" href="#initial-reproduction-number"></a>
</h3>
<p>Lastly we need to choose a prior for the initial value of the
reproduction number. This is assumed by the model to be normally
distributed and we can set the mean and the standard deviation. We
decide to set the mean to 2 and the standard deviation to 1.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rt_prior</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Distributions.html">LogNormal</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fl">2</span>, sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="running-the-model">Running the model<a class="anchor" aria-label="anchor" href="#running-the-model"></a>
</h2>
<p>We are now ready to run the model and will in the following show a
number of possible options for doing so.</p>
<div class="section level3">
<h3 id="default-options">Default options<a class="anchor" aria-label="anchor" href="#default-options"></a>
</h3>
<p>By default the model uses a renewal equation for infections and a
Gaussian Process prior for the reproduction number. Putting all the data
and parameters together and tweaking the Gaussian Process to have a
shorter length scale prior than the default we run.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">def</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estimate_infections.html">estimate_infections</a></span><span class="op">(</span><span class="va">reported_cases</span>,</span>
<span>  generation_time <span class="op">=</span> <span class="fu"><a href="../reference/generation_time_opts.html">gt_opts</a></span><span class="op">(</span><span class="va">example_generation_time</span><span class="op">)</span>,</span>
<span>  delays <span class="op">=</span> <span class="fu"><a href="../reference/delay_opts.html">delay_opts</a></span><span class="op">(</span><span class="va">delay</span><span class="op">)</span>,</span>
<span>  rt <span class="op">=</span> <span class="fu"><a href="../reference/rt_opts.html">rt_opts</a></span><span class="op">(</span>prior <span class="op">=</span> <span class="va">rt_prior</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: There were 2 divergent transitions after warmup. See</span></span>
<span><span class="co">#&gt; https://mc-stan.org/misc/warnings.html#divergent-transitions-after-warmup</span></span>
<span><span class="co">#&gt; to find out why this is a problem and how to eliminate them.</span></span>
<span><span class="co">#&gt; Warning: Examine the pairs() plot to diagnose sampling problems</span></span>
<span><span class="co"># summarise results</span></span>
<span><span class="fu"><a href="../reference/summary.epinow.html">summary</a></span><span class="op">(</span><span class="va">def</span><span class="op">)</span></span>
<span><span class="co">#&gt;                         measure                 estimate</span></span>
<span><span class="co">#&gt;                          &lt;char&gt;                   &lt;char&gt;</span></span>
<span><span class="co">#&gt; 1:       New infections per day      2247 (1389 -- 3664)</span></span>
<span><span class="co">#&gt; 2:   Expected change in reports        Likely decreasing</span></span>
<span><span class="co">#&gt; 3:   Effective reproduction no.        0.89 (0.7 -- 1.1)</span></span>
<span><span class="co">#&gt; 4:               Rate of growth -0.029 (-0.096 -- 0.035)</span></span>
<span><span class="co">#&gt; 5: Doubling/halving time (days)         -24 (20 -- -7.2)</span></span>
<span><span class="co"># elapsed time (in seconds)</span></span>
<span><span class="fu"><a href="https://mc-stan.org/rstan/reference/stanfit-class.html" class="external-link">get_elapsed_time</a></span><span class="op">(</span><span class="va">def</span><span class="op">$</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="co">#&gt;         warmup sample</span></span>
<span><span class="co">#&gt; chain:1 27.765 22.503</span></span>
<span><span class="co">#&gt; chain:2 35.713 24.136</span></span>
<span><span class="co">#&gt; chain:3 32.521 18.155</span></span>
<span><span class="co">#&gt; chain:4 32.838 19.113</span></span>
<span><span class="co"># summary plot</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">def</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="estimate_infections_options-default-1.png" alt="plot of chunk default"><div class="figcaption">plot of chunk default</div>
</div>
</div>
<div class="section level3">
<h3 id="reducing-the-accuracy-of-the-approximate-gaussian-process">Reducing the accuracy of the approximate Gaussian Process<a class="anchor" aria-label="anchor" href="#reducing-the-accuracy-of-the-approximate-gaussian-process"></a>
</h3>
<p>To speed up the calculation of the Gaussian Process we could decrease
its accuracy, e.g. decrease the proportion of time points to use as
basis functions from the default of 0.2 to 0.1.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">agp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estimate_infections.html">estimate_infections</a></span><span class="op">(</span><span class="va">reported_cases</span>,</span>
<span>  generation_time <span class="op">=</span> <span class="fu"><a href="../reference/generation_time_opts.html">gt_opts</a></span><span class="op">(</span><span class="va">example_generation_time</span><span class="op">)</span>,</span>
<span>  delays <span class="op">=</span> <span class="fu"><a href="../reference/delay_opts.html">delay_opts</a></span><span class="op">(</span><span class="va">delay</span><span class="op">)</span>,</span>
<span>  rt <span class="op">=</span> <span class="fu"><a href="../reference/rt_opts.html">rt_opts</a></span><span class="op">(</span>prior <span class="op">=</span> <span class="va">rt_prior</span><span class="op">)</span>,</span>
<span>  gp <span class="op">=</span> <span class="fu"><a href="../reference/gp_opts.html">gp_opts</a></span><span class="op">(</span>basis_prop <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># summarise results</span></span>
<span><span class="fu"><a href="../reference/summary.epinow.html">summary</a></span><span class="op">(</span><span class="va">agp</span><span class="op">)</span></span>
<span><span class="co">#&gt;                         measure                 estimate</span></span>
<span><span class="co">#&gt;                          &lt;char&gt;                   &lt;char&gt;</span></span>
<span><span class="co">#&gt; 1:       New infections per day      2272 (1425 -- 3803)</span></span>
<span><span class="co">#&gt; 2:   Expected change in reports        Likely decreasing</span></span>
<span><span class="co">#&gt; 3:   Effective reproduction no.        0.9 (0.72 -- 1.1)</span></span>
<span><span class="co">#&gt; 4:               Rate of growth -0.027 (-0.089 -- 0.039)</span></span>
<span><span class="co">#&gt; 5: Doubling/halving time (days)         -25 (18 -- -7.8)</span></span>
<span><span class="co"># elapsed time (in seconds)</span></span>
<span><span class="fu"><a href="https://mc-stan.org/rstan/reference/stanfit-class.html" class="external-link">get_elapsed_time</a></span><span class="op">(</span><span class="va">agp</span><span class="op">$</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="co">#&gt;         warmup sample</span></span>
<span><span class="co">#&gt; chain:1 22.305 30.356</span></span>
<span><span class="co">#&gt; chain:2 26.603 29.369</span></span>
<span><span class="co">#&gt; chain:3 21.782 28.270</span></span>
<span><span class="co">#&gt; chain:4 24.389 29.475</span></span>
<span><span class="co"># summary plot</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">agp</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="estimate_infections_options-lower_accuracy-1.png" alt="plot of chunk lower_accuracy"><div class="figcaption">plot of chunk lower_accuracy</div>
</div>
</div>
<div class="section level3">
<h3 id="adjusting-for-future-susceptible-depletion">Adjusting for future susceptible depletion<a class="anchor" aria-label="anchor" href="#adjusting-for-future-susceptible-depletion"></a>
</h3>
<p>We might want to adjust for future susceptible depletion. Here, we do
so by setting the population to 1000000 and projecting the reproduction
number from the latest estimate (rather than the default, which fixes
the reproduction number to an earlier time point based on the given
reporting delays). Note that this only affects the forecasts and is done
using a crude adjustment (see the <a href="estimate_infections.html">model definition</a>).</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dep</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estimate_infections.html">estimate_infections</a></span><span class="op">(</span><span class="va">reported_cases</span>,</span>
<span>  generation_time <span class="op">=</span> <span class="fu"><a href="../reference/generation_time_opts.html">gt_opts</a></span><span class="op">(</span><span class="va">example_generation_time</span><span class="op">)</span>,</span>
<span>  delays <span class="op">=</span> <span class="fu"><a href="../reference/delay_opts.html">delay_opts</a></span><span class="op">(</span><span class="va">delay</span><span class="op">)</span>,</span>
<span>  rt <span class="op">=</span> <span class="fu"><a href="../reference/rt_opts.html">rt_opts</a></span><span class="op">(</span></span>
<span>    prior <span class="op">=</span> <span class="va">rt_prior</span>,</span>
<span>    pop <span class="op">=</span> <span class="fu"><a href="../reference/Distributions.html">Normal</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fl">1000000</span>, sd <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span>, future <span class="op">=</span> <span class="st">"latest"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># summarise results</span></span>
<span><span class="fu"><a href="../reference/summary.epinow.html">summary</a></span><span class="op">(</span><span class="va">dep</span><span class="op">)</span></span>
<span><span class="co">#&gt;                         measure                estimate</span></span>
<span><span class="co">#&gt;                          &lt;char&gt;                  &lt;char&gt;</span></span>
<span><span class="co">#&gt; 1:       New infections per day     2221 (1389 -- 3629)</span></span>
<span><span class="co">#&gt; 2:   Expected change in reports       Likely decreasing</span></span>
<span><span class="co">#&gt; 3:   Effective reproduction no.      0.89 (0.71 -- 1.1)</span></span>
<span><span class="co">#&gt; 4:               Rate of growth -0.03 (-0.093 -- 0.037)</span></span>
<span><span class="co">#&gt; 5: Doubling/halving time (days)        -23 (19 -- -7.4)</span></span>
<span><span class="co"># elapsed time (in seconds)</span></span>
<span><span class="fu"><a href="https://mc-stan.org/rstan/reference/stanfit-class.html" class="external-link">get_elapsed_time</a></span><span class="op">(</span><span class="va">dep</span><span class="op">$</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="co">#&gt;         warmup sample</span></span>
<span><span class="co">#&gt; chain:1 38.125 19.934</span></span>
<span><span class="co">#&gt; chain:2 18.102 32.649</span></span>
<span><span class="co">#&gt; chain:3 27.667 19.544</span></span>
<span><span class="co">#&gt; chain:4 42.988 24.850</span></span>
<span><span class="co"># summary plot</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">dep</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="estimate_infections_options-susceptible_depletion-1.png" alt="plot of chunk susceptible_depletion"><div class="figcaption">plot of chunk susceptible_depletion</div>
</div>
</div>
<div class="section level3">
<h3 id="adjusting-for-truncation-of-the-most-recent-data">Adjusting for truncation of the most recent data<a class="anchor" aria-label="anchor" href="#adjusting-for-truncation-of-the-most-recent-data"></a>
</h3>
<p>We might further want to adjust for right-truncation of recent data
estimated using the <a href="estimate_truncation.html">estimate_truncation</a> model. Here,
instead of doing so we assume that we know about truncation with mean of
1/2 day, sd 1/2 day, following a lognormal distribution and with a
maximum of three days.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trunc_dist</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Distributions.html">LogNormal</a></span><span class="op">(</span></span>
<span>  mean <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  sd <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  max <span class="op">=</span> <span class="fl">3</span></span>
<span><span class="op">)</span></span>
<span><span class="va">trunc_dist</span></span>
<span><span class="co">#&gt; - lognormal distribution (max: 3):</span></span>
<span><span class="co">#&gt;   meanlog:</span></span>
<span><span class="co">#&gt;     -1</span></span>
<span><span class="co">#&gt;   sdlog:</span></span>
<span><span class="co">#&gt;     0.83</span></span></code></pre></div>
<p>We can then use this in the <code>esimtate_infections()</code>
function using the <code>truncation</code> option.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trunc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estimate_infections.html">estimate_infections</a></span><span class="op">(</span><span class="va">reported_cases</span>,</span>
<span>  generation_time <span class="op">=</span> <span class="fu"><a href="../reference/generation_time_opts.html">gt_opts</a></span><span class="op">(</span><span class="va">example_generation_time</span><span class="op">)</span>,</span>
<span>  delays <span class="op">=</span> <span class="fu"><a href="../reference/delay_opts.html">delay_opts</a></span><span class="op">(</span><span class="va">delay</span><span class="op">)</span>,</span>
<span>  truncation <span class="op">=</span> <span class="fu"><a href="../reference/trunc_opts.html">trunc_opts</a></span><span class="op">(</span><span class="va">trunc_dist</span><span class="op">)</span>,</span>
<span>  rt <span class="op">=</span> <span class="fu"><a href="../reference/rt_opts.html">rt_opts</a></span><span class="op">(</span>prior <span class="op">=</span> <span class="va">rt_prior</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: There were 1 divergent transitions after warmup. See</span></span>
<span><span class="co">#&gt; https://mc-stan.org/misc/warnings.html#divergent-transitions-after-warmup</span></span>
<span><span class="co">#&gt; to find out why this is a problem and how to eliminate them.</span></span>
<span><span class="co">#&gt; Warning: Examine the pairs() plot to diagnose sampling problems</span></span>
<span><span class="co"># summarise results</span></span>
<span><span class="fu"><a href="../reference/summary.epinow.html">summary</a></span><span class="op">(</span><span class="va">trunc</span><span class="op">)</span></span>
<span><span class="co">#&gt;                         measure                estimate</span></span>
<span><span class="co">#&gt;                          &lt;char&gt;                  &lt;char&gt;</span></span>
<span><span class="co">#&gt; 1:       New infections per day     3608 (2212 -- 6238)</span></span>
<span><span class="co">#&gt; 2:   Expected change in reports       Likely increasing</span></span>
<span><span class="co">#&gt; 3:   Effective reproduction no.         1 (0.85 -- 1.3)</span></span>
<span><span class="co">#&gt; 4:               Rate of growth 0.017 (-0.049 -- 0.096)</span></span>
<span><span class="co">#&gt; 5: Doubling/halving time (days)         40 (7.2 -- -14)</span></span>
<span><span class="co"># elapsed time (in seconds)</span></span>
<span><span class="fu"><a href="https://mc-stan.org/rstan/reference/stanfit-class.html" class="external-link">get_elapsed_time</a></span><span class="op">(</span><span class="va">trunc</span><span class="op">$</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="co">#&gt;         warmup sample</span></span>
<span><span class="co">#&gt; chain:1 32.305 19.660</span></span>
<span><span class="co">#&gt; chain:2 29.547 24.074</span></span>
<span><span class="co">#&gt; chain:3 31.790 17.835</span></span>
<span><span class="co">#&gt; chain:4 26.044 31.725</span></span>
<span><span class="co"># summary plot</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">trunc</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="estimate_infections_options-truncation-1.png" alt="plot of chunk truncation"><div class="figcaption">plot of chunk truncation</div>
</div>
</div>
<div class="section level3">
<h3 id="projecting-the-reproduction-number-with-the-gaussian-process">Projecting the reproduction number with the Gaussian Process<a class="anchor" aria-label="anchor" href="#projecting-the-reproduction-number-with-the-gaussian-process"></a>
</h3>
<p>Instead of keeping the reproduction number fixed from a certain time
point we might want to extrapolate the Gaussian Process into the future.
This will lead to wider uncertainty, and the researcher should check
whether this or fixing the reproduction number from an earlier is
desirable.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">project_rt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estimate_infections.html">estimate_infections</a></span><span class="op">(</span><span class="va">reported_cases</span>,</span>
<span>  generation_time <span class="op">=</span> <span class="fu"><a href="../reference/generation_time_opts.html">gt_opts</a></span><span class="op">(</span><span class="va">example_generation_time</span><span class="op">)</span>,</span>
<span>  delays <span class="op">=</span> <span class="fu"><a href="../reference/delay_opts.html">delay_opts</a></span><span class="op">(</span><span class="va">delay</span><span class="op">)</span>,</span>
<span>  rt <span class="op">=</span> <span class="fu"><a href="../reference/rt_opts.html">rt_opts</a></span><span class="op">(</span></span>
<span>    prior <span class="op">=</span> <span class="va">rt_prior</span>, future <span class="op">=</span> <span class="st">"project"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: There were 1 divergent transitions after warmup. See</span></span>
<span><span class="co">#&gt; https://mc-stan.org/misc/warnings.html#divergent-transitions-after-warmup</span></span>
<span><span class="co">#&gt; to find out why this is a problem and how to eliminate them.</span></span>
<span><span class="co">#&gt; Warning: Examine the pairs() plot to diagnose sampling problems</span></span>
<span><span class="co"># summarise results</span></span>
<span><span class="fu"><a href="../reference/summary.epinow.html">summary</a></span><span class="op">(</span><span class="va">project_rt</span><span class="op">)</span></span>
<span><span class="co">#&gt;                         measure               estimate</span></span>
<span><span class="co">#&gt;                          &lt;char&gt;                 &lt;char&gt;</span></span>
<span><span class="co">#&gt; 1:       New infections per day    2228 (1337 -- 3624)</span></span>
<span><span class="co">#&gt; 2:   Expected change in reports      Likely decreasing</span></span>
<span><span class="co">#&gt; 3:   Effective reproduction no.      0.89 (0.7 -- 1.1)</span></span>
<span><span class="co">#&gt; 4:               Rate of growth -0.029 (-0.1 -- 0.038)</span></span>
<span><span class="co">#&gt; 5: Doubling/halving time (days)       -24 (18 -- -6.9)</span></span>
<span><span class="co"># elapsed time (in seconds)</span></span>
<span><span class="fu"><a href="https://mc-stan.org/rstan/reference/stanfit-class.html" class="external-link">get_elapsed_time</a></span><span class="op">(</span><span class="va">project_rt</span><span class="op">$</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="co">#&gt;         warmup sample</span></span>
<span><span class="co">#&gt; chain:1 35.948 32.925</span></span>
<span><span class="co">#&gt; chain:2 30.477 29.067</span></span>
<span><span class="co">#&gt; chain:3 32.482 36.349</span></span>
<span><span class="co">#&gt; chain:4 34.664 30.712</span></span>
<span><span class="co"># summary plot</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">project_rt</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="estimate_infections_options-gp_projection-1.png" alt="plot of chunk gp_projection"><div class="figcaption">plot of chunk gp_projection</div>
</div>
</div>
<div class="section level3">
<h3 id="fixed-reproduction-number">Fixed reproduction number<a class="anchor" aria-label="anchor" href="#fixed-reproduction-number"></a>
</h3>
<p>We might want to estimate a fixed reproduction number, i.e. assume
that it does not change.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fixed</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estimate_infections.html">estimate_infections</a></span><span class="op">(</span><span class="va">reported_cases</span>,</span>
<span>  generation_time <span class="op">=</span> <span class="fu"><a href="../reference/generation_time_opts.html">gt_opts</a></span><span class="op">(</span><span class="va">example_generation_time</span><span class="op">)</span>,</span>
<span>  delays <span class="op">=</span> <span class="fu"><a href="../reference/delay_opts.html">delay_opts</a></span><span class="op">(</span><span class="va">delay</span><span class="op">)</span>,</span>
<span>  gp <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># summarise results</span></span>
<span><span class="fu"><a href="../reference/summary.epinow.html">summary</a></span><span class="op">(</span><span class="va">fixed</span><span class="op">)</span></span>
<span><span class="co">#&gt;                         measure               estimate</span></span>
<span><span class="co">#&gt;                          &lt;char&gt;                 &lt;char&gt;</span></span>
<span><span class="co">#&gt; 1:       New infections per day 18832 (10849 -- 33589)</span></span>
<span><span class="co">#&gt; 2:   Expected change in reports             Increasing</span></span>
<span><span class="co">#&gt; 3:   Effective reproduction no.       1.2 (1.2 -- 1.3)</span></span>
<span><span class="co">#&gt; 4:               Rate of growth 0.053 (0.039 -- 0.068)</span></span>
<span><span class="co">#&gt; 5: Doubling/halving time (days)          13 (10 -- 18)</span></span>
<span><span class="co"># elapsed time (in seconds)</span></span>
<span><span class="fu"><a href="https://mc-stan.org/rstan/reference/stanfit-class.html" class="external-link">get_elapsed_time</a></span><span class="op">(</span><span class="va">fixed</span><span class="op">$</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="co">#&gt;         warmup sample</span></span>
<span><span class="co">#&gt; chain:1  1.410  0.954</span></span>
<span><span class="co">#&gt; chain:2  1.767  1.268</span></span>
<span><span class="co">#&gt; chain:3  1.709  0.931</span></span>
<span><span class="co">#&gt; chain:4  1.567  0.946</span></span>
<span><span class="co"># summary plot</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fixed</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="estimate_infections_options-fixed-1.png" alt="plot of chunk fixed"><div class="figcaption">plot of chunk fixed</div>
</div>
</div>
<div class="section level3">
<h3 id="breakpoints">Breakpoints<a class="anchor" aria-label="anchor" href="#breakpoints"></a>
</h3>
<p>Instead of assuming the reproduction number varies freely or is
fixed, we can assume that it is fixed but with breakpoints. This can be
done by adding a <code>breakpoint</code> column to the reported case
data set. e.g. if we think that the reproduction number was constant but
would like to allow it to change on the 16th of March 2020 we would
define a new case data set using</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bp_cases</span> <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/data.table/man/copy.html" class="external-link">copy</a></span><span class="op">(</span><span class="va">reported_cases</span><span class="op">)</span></span>
<span><span class="va">bp_cases</span> <span class="op">&lt;-</span> <span class="va">bp_cases</span><span class="op">[</span>,</span>
<span> <span class="va">breakpoint</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">date</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2020-03-16"</span><span class="op">)</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span></span>
<span><span class="op">]</span></span></code></pre></div>
<p>We then use this instead of <code>reported_cases</code> in the
<code><a href="../reference/estimate_infections.html">estimate_infections()</a></code> function:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bkp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estimate_infections.html">estimate_infections</a></span><span class="op">(</span><span class="va">bp_cases</span>,</span>
<span>  generation_time <span class="op">=</span> <span class="fu"><a href="../reference/generation_time_opts.html">gt_opts</a></span><span class="op">(</span><span class="va">example_generation_time</span><span class="op">)</span>,</span>
<span>  delays <span class="op">=</span> <span class="fu"><a href="../reference/delay_opts.html">delay_opts</a></span><span class="op">(</span><span class="va">delay</span><span class="op">)</span>,</span>
<span>  rt <span class="op">=</span> <span class="fu"><a href="../reference/rt_opts.html">rt_opts</a></span><span class="op">(</span>prior <span class="op">=</span> <span class="va">rt_prior</span><span class="op">)</span>,</span>
<span>  gp <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># summarise results</span></span>
<span><span class="fu"><a href="../reference/summary.epinow.html">summary</a></span><span class="op">(</span><span class="va">bkp</span><span class="op">)</span></span>
<span><span class="co">#&gt;                         measure                  estimate</span></span>
<span><span class="co">#&gt;                          &lt;char&gt;                    &lt;char&gt;</span></span>
<span><span class="co">#&gt; 1:       New infections per day       2306 (1942 -- 2763)</span></span>
<span><span class="co">#&gt; 2:   Expected change in reports                Decreasing</span></span>
<span><span class="co">#&gt; 3:   Effective reproduction no.        0.9 (0.87 -- 0.92)</span></span>
<span><span class="co">#&gt; 4:               Rate of growth -0.028 (-0.034 -- -0.022)</span></span>
<span><span class="co">#&gt; 5: Doubling/halving time (days)          -25 (-32 -- -20)</span></span>
<span><span class="co"># elapsed time (in seconds)</span></span>
<span><span class="fu"><a href="https://mc-stan.org/rstan/reference/stanfit-class.html" class="external-link">get_elapsed_time</a></span><span class="op">(</span><span class="va">bkp</span><span class="op">$</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="co">#&gt;         warmup sample</span></span>
<span><span class="co">#&gt; chain:1  2.571  3.796</span></span>
<span><span class="co">#&gt; chain:2  3.108  4.100</span></span>
<span><span class="co">#&gt; chain:3  2.557  4.216</span></span>
<span><span class="co">#&gt; chain:4  3.394  3.859</span></span>
<span><span class="co"># summary plot</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">bkp</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="estimate_infections_options-bp-1.png" alt="plot of chunk bp"><div class="figcaption">plot of chunk bp</div>
</div>
</div>
<div class="section level3">
<h3 id="weekly-random-walk">Weekly random walk<a class="anchor" aria-label="anchor" href="#weekly-random-walk"></a>
</h3>
<p>Instead of a smooth Gaussian Process we might want the reproduction
number to change step-wise, e.g. every week. This can be achieved using
the <code>rw</code> option which defines the length of the time step in
a random walk that the reproduction number is assumed to follow.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rw</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estimate_infections.html">estimate_infections</a></span><span class="op">(</span><span class="va">reported_cases</span>,</span>
<span>  generation_time <span class="op">=</span> <span class="fu"><a href="../reference/generation_time_opts.html">gt_opts</a></span><span class="op">(</span><span class="va">example_generation_time</span><span class="op">)</span>,</span>
<span>  delays <span class="op">=</span> <span class="fu"><a href="../reference/delay_opts.html">delay_opts</a></span><span class="op">(</span><span class="va">delay</span><span class="op">)</span>,</span>
<span>  rt <span class="op">=</span> <span class="fu"><a href="../reference/rt_opts.html">rt_opts</a></span><span class="op">(</span>prior <span class="op">=</span> <span class="va">rt_prior</span>, rw <span class="op">=</span> <span class="fl">7</span><span class="op">)</span>,</span>
<span>  gp <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># summarise results</span></span>
<span><span class="fu"><a href="../reference/summary.epinow.html">summary</a></span><span class="op">(</span><span class="va">rw</span><span class="op">)</span></span>
<span><span class="co">#&gt;                         measure                estimate</span></span>
<span><span class="co">#&gt;                          &lt;char&gt;                  &lt;char&gt;</span></span>
<span><span class="co">#&gt; 1:       New infections per day     1984 (1021 -- 3886)</span></span>
<span><span class="co">#&gt; 2:   Expected change in reports       Likely decreasing</span></span>
<span><span class="co">#&gt; 3:   Effective reproduction no.      0.85 (0.61 -- 1.2)</span></span>
<span><span class="co">#&gt; 4:               Rate of growth -0.042 (-0.11 -- 0.036)</span></span>
<span><span class="co">#&gt; 5: Doubling/halving time (days)        -16 (19 -- -6.1)</span></span>
<span><span class="co"># elapsed time (in seconds)</span></span>
<span><span class="fu"><a href="https://mc-stan.org/rstan/reference/stanfit-class.html" class="external-link">get_elapsed_time</a></span><span class="op">(</span><span class="va">rw</span><span class="op">$</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="co">#&gt;         warmup sample</span></span>
<span><span class="co">#&gt; chain:1  8.006 10.885</span></span>
<span><span class="co">#&gt; chain:2  8.668 12.636</span></span>
<span><span class="co">#&gt; chain:3  8.297 14.310</span></span>
<span><span class="co">#&gt; chain:4  9.199 14.633</span></span>
<span><span class="co"># summary plot</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">rw</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="estimate_infections_options-weekly_rw-1.png" alt="plot of chunk weekly_rw"><div class="figcaption">plot of chunk weekly_rw</div>
</div>
</div>
<div class="section level3">
<h3 id="no-delays">No delays<a class="anchor" aria-label="anchor" href="#no-delays"></a>
</h3>
<p>Whilst <em>EpiNow2</em> allows the user to specify delays, it can
also run directly on the data as does e.g. the <a href="https://CRAN.R-project.org/package=EpiEstim" class="external-link">EpiEstim</a>
package.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">no_delay</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estimate_infections.html">estimate_infections</a></span><span class="op">(</span></span>
<span>  <span class="va">reported_cases</span>,</span>
<span>  generation_time <span class="op">=</span> <span class="fu"><a href="../reference/generation_time_opts.html">gt_opts</a></span><span class="op">(</span><span class="va">example_generation_time</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># summarise results</span></span>
<span><span class="fu"><a href="../reference/summary.epinow.html">summary</a></span><span class="op">(</span><span class="va">no_delay</span><span class="op">)</span></span>
<span><span class="co">#&gt;                         measure                  estimate</span></span>
<span><span class="co">#&gt;                          &lt;char&gt;                    &lt;char&gt;</span></span>
<span><span class="co">#&gt; 1:       New infections per day       2798 (2400 -- 3293)</span></span>
<span><span class="co">#&gt; 2:   Expected change in reports                Decreasing</span></span>
<span><span class="co">#&gt; 3:   Effective reproduction no.       0.89 (0.81 -- 0.98)</span></span>
<span><span class="co">#&gt; 4:               Rate of growth -0.031 (-0.062 -- 0.0016)</span></span>
<span><span class="co">#&gt; 5: Doubling/halving time (days)          -23 (430 -- -11)</span></span>
<span><span class="co"># elapsed time (in seconds)</span></span>
<span><span class="fu"><a href="https://mc-stan.org/rstan/reference/stanfit-class.html" class="external-link">get_elapsed_time</a></span><span class="op">(</span><span class="va">no_delay</span><span class="op">$</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="co">#&gt;         warmup sample</span></span>
<span><span class="co">#&gt; chain:1 35.001 38.517</span></span>
<span><span class="co">#&gt; chain:2 34.509 43.011</span></span>
<span><span class="co">#&gt; chain:3 36.099 29.895</span></span>
<span><span class="co">#&gt; chain:4 32.443 29.725</span></span>
<span><span class="co"># summary plot</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">no_delay</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="estimate_infections_options-no_delays-1.png" alt="plot of chunk no_delays"><div class="figcaption">plot of chunk no_delays</div>
</div>
</div>
<div class="section level3">
<h3 id="non-parametric-infection-model">Non-parametric infection model<a class="anchor" aria-label="anchor" href="#non-parametric-infection-model"></a>
</h3>
<p>The package also includes a non-parametric infection model. This runs
much faster but does not use the renewal equation to generate
infections. Because of this none of the options defining the behaviour
of the reproduction number are available in this case, limiting user
choice and model generality. It also means that the model is
questionable for forecasting, which is why were here set the predictive
horizon to 0.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">non_parametric</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estimate_infections.html">estimate_infections</a></span><span class="op">(</span><span class="va">reported_cases</span>,</span>
<span>  generation_time <span class="op">=</span> <span class="fu"><a href="../reference/generation_time_opts.html">gt_opts</a></span><span class="op">(</span><span class="va">example_generation_time</span><span class="op">)</span>,</span>
<span>  delays <span class="op">=</span> <span class="fu"><a href="../reference/delay_opts.html">delay_opts</a></span><span class="op">(</span><span class="va">delay</span><span class="op">)</span>,</span>
<span>  rt <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  backcalc <span class="op">=</span> <span class="fu"><a href="../reference/backcalc_opts.html">backcalc_opts</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  forecast <span class="op">=</span> <span class="fu"><a href="../reference/forecast_opts.html">forecast_opts</a></span><span class="op">(</span>horizon <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># summarise results</span></span>
<span><span class="fu"><a href="../reference/summary.epinow.html">summary</a></span><span class="op">(</span><span class="va">non_parametric</span><span class="op">)</span></span>
<span><span class="co">#&gt;                         measure                  estimate</span></span>
<span><span class="co">#&gt;                          &lt;char&gt;                    &lt;char&gt;</span></span>
<span><span class="co">#&gt; 1:       New infections per day       2543 (2502 -- 2586)</span></span>
<span><span class="co">#&gt; 2:   Expected change in reports                Decreasing</span></span>
<span><span class="co">#&gt; 3:   Effective reproduction no.       0.91 (0.83 -- 0.96)</span></span>
<span><span class="co">#&gt; 4:               Rate of growth -0.024 (-0.025 -- -0.023)</span></span>
<span><span class="co">#&gt; 5: Doubling/halving time (days)          -29 (-31 -- -28)</span></span>
<span><span class="co"># elapsed time (in seconds)</span></span>
<span><span class="fu"><a href="https://mc-stan.org/rstan/reference/stanfit-class.html" class="external-link">get_elapsed_time</a></span><span class="op">(</span><span class="va">non_parametric</span><span class="op">$</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="co">#&gt;         warmup sample</span></span>
<span><span class="co">#&gt; chain:1  3.827  0.581</span></span>
<span><span class="co">#&gt; chain:2  3.857  0.432</span></span>
<span><span class="co">#&gt; chain:3  3.625  0.553</span></span>
<span><span class="co">#&gt; chain:4  4.916  0.355</span></span>
<span><span class="co"># summary plot</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">non_parametric</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="estimate_infections_options-nonparametric-1.png" alt="plot of chunk nonparametric"><div class="figcaption">plot of chunk nonparametric</div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://www.samabbott.co.uk/" class="external-link">Sam Abbott</a>, Joel Hellewell, Katharine Sherratt, Katelyn Gostic, Joe Hickson, Hamada S. Badr, Michael DeWitt, James M. Azam, Adrian Lison, <a href="https://www.lshtm.ac.uk/aboutus/people/funk.sebastian" class="external-link">Sebastian Funk</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
