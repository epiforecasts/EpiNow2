# Real-time Rt Estimation, Forecasting and Reporting

**\[stable\]** This function wraps the functionality of
[`estimate_infections()`](https://epiforecasts.io/EpiNow2/reference/estimate_infections.md)
in order to estimate Rt and cases by date of infection and forecast
these infections into the future. In addition to the functionality of
[`estimate_infections()`](https://epiforecasts.io/EpiNow2/reference/estimate_infections.md)
it produces additional summary output useful for reporting results and
interpreting them as well as error catching and reporting, making it
particularly useful for production use e.g. running at set intervals on
a dedicated server.

## Usage

``` r
epinow(
  data,
  generation_time = gt_opts(),
  delays = delay_opts(),
  truncation = trunc_opts(),
  rt = rt_opts(),
  backcalc = backcalc_opts(),
  gp = gp_opts(),
  obs = obs_opts(),
  forecast = forecast_opts(),
  stan = stan_opts(),
  CrIs = c(0.2, 0.5, 0.9),
  return_output = is.null(target_folder),
  output = c("samples", "plots", "latest", "fit", "timing", "estimate_infections"),
  plot_args = list(),
  target_folder = NULL,
  target_date,
  logs = tempdir(),
  id = "epinow",
  verbose = interactive(),
  filter_leading_zeros = TRUE,
  zero_threshold = Inf,
  horizon
)
```

## Arguments

- data:

  A `<data.frame>` of disease reports (confirm) by date (date).
  `confirm` must be numeric and `date` must be in date format.
  Optionally, `data` can also have a logical `accumulate` column which
  indicates whether data should be added to the next data point. This is
  useful when modelling e.g. weekly incidence data. See also the
  [`fill_missing()`](https://epiforecasts.io/EpiNow2/reference/fill_missing.md)
  function which helps add the `accumulate` column with the desired
  properties when dealing with non-daily data. If any accumulation is
  done this happens after truncation as specified by the `truncation`
  argument. If all entries of `confirm` are missing (`NA`) the returned
  estimates will represent the prior distributions.

- generation_time:

  A call to
  [`gt_opts()`](https://epiforecasts.io/EpiNow2/reference/generation_time_opts.md)
  (or its alias
  [`generation_time_opts()`](https://epiforecasts.io/EpiNow2/reference/generation_time_opts.md))
  defining the generation time distribution used. For backwards
  compatibility a list of summary parameters can also be passed.

- delays:

  A call to
  [`delay_opts()`](https://epiforecasts.io/EpiNow2/reference/delay_opts.md)
  defining delay distributions and options. See the documentation of
  [`delay_opts()`](https://epiforecasts.io/EpiNow2/reference/delay_opts.md)
  and the examples below for details.

- truncation:

  A call to
  [`trunc_opts()`](https://epiforecasts.io/EpiNow2/reference/trunc_opts.md)
  defining the truncation of the observed data. Defaults to
  [`trunc_opts()`](https://epiforecasts.io/EpiNow2/reference/trunc_opts.md),
  i.e. no truncation. See the
  [`estimate_truncation()`](https://epiforecasts.io/EpiNow2/reference/estimate_truncation.md)
  help file for an approach to estimating this from data where the
  `dist` list element returned by
  [`estimate_truncation()`](https://epiforecasts.io/EpiNow2/reference/estimate_truncation.md)
  is used as the `truncation` argument here, thereby propagating the
  uncertainty in the estimate.

- rt:

  A list of options as generated by
  [`rt_opts()`](https://epiforecasts.io/EpiNow2/reference/rt_opts.md)
  defining Rt estimation. Defaults to
  [`rt_opts()`](https://epiforecasts.io/EpiNow2/reference/rt_opts.md).
  To generate new infections using the non-mechanistic model instead of
  the renewal equation model, use `rt = NULL`. The non-mechanistic model
  internally uses the setting
  `rt = rt_opts(use_rt = FALSE, future = "project", gp_on = "R0")`.

- backcalc:

  A list of options as generated by
  [`backcalc_opts()`](https://epiforecasts.io/EpiNow2/reference/backcalc_opts.md)
  to define the back calculation. Defaults to
  [`backcalc_opts()`](https://epiforecasts.io/EpiNow2/reference/backcalc_opts.md).

- gp:

  A list of options as generated by
  [`gp_opts()`](https://epiforecasts.io/EpiNow2/reference/gp_opts.md) to
  define the Gaussian process. Defaults to
  [`gp_opts()`](https://epiforecasts.io/EpiNow2/reference/gp_opts.md).
  Set to `NULL` to disable the Gaussian process.

- obs:

  A list of options as generated by
  [`obs_opts()`](https://epiforecasts.io/EpiNow2/reference/obs_opts.md)
  defining the observation model. Defaults to
  [`obs_opts()`](https://epiforecasts.io/EpiNow2/reference/obs_opts.md).

- forecast:

  A list of options as generated by
  [`forecast_opts()`](https://epiforecasts.io/EpiNow2/reference/forecast_opts.md)
  defining the forecast opitions. Defaults to
  [`forecast_opts()`](https://epiforecasts.io/EpiNow2/reference/forecast_opts.md).
  If NULL then no forecasting will be done.

- stan:

  A list of stan options as generated by
  [`stan_opts()`](https://epiforecasts.io/EpiNow2/reference/stan_opts.md).
  Defaults to
  [`stan_opts()`](https://epiforecasts.io/EpiNow2/reference/stan_opts.md).
  Can be used to override `data`, `init`, and `verbose` settings if
  desired.

- CrIs:

  Numeric vector of credible intervals to calculate.

- return_output:

  Logical, defaults to FALSE. Should output be returned, this
  automatically updates to TRUE if no directory for saving is specified.

- output:

  A character vector of optional output to return. Supported options are
  samples ("samples"), plots ("plots"), the run time ("timing"), copying
  the dated folder into a latest folder (if `target_folder` is not null,
  set using "latest"), the stan fit ("fit"), and the full
  [`estimate_infections()`](https://epiforecasts.io/EpiNow2/reference/estimate_infections.md)
  return object ("estimate_infections"). The default is to return all
  options.

- plot_args:

  A list of optional arguments passed to
  [`plot.estimate_infections()`](https://epiforecasts.io/EpiNow2/reference/plot.estimate_infections.md).

- target_folder:

  Character string specifying where to save results (will create if not
  present).

- target_date:

  Date, defaults to maximum found in the data if not specified.

- logs:

  Character path indicating the target folder in which to store log
  information. Defaults to the temporary directory if not specified.
  Default logging can be disabled if `logs` is set to NULL. If
  specifying a custom logging setup then the code for
  [`setup_default_logging()`](https://epiforecasts.io/EpiNow2/reference/setup_default_logging.md)
  and the
  [`setup_logging()`](https://epiforecasts.io/EpiNow2/reference/setup_logging.md)
  function are a sensible place to start.

- id:

  A character string used to assign logging information on error. Used
  by
  [`regional_epinow()`](https://epiforecasts.io/EpiNow2/reference/regional_epinow.md)
  to assign errors to regions. Alter the default to run with error
  catching.

- verbose:

  Logical, defaults to `TRUE` when used interactively and otherwise
  `FALSE`. Should verbose debug progress messages be printed.
  Corresponds to the "DEBUG" level from `futile.logger`. See
  `setup_logging` for more detailed logging options.

- filter_leading_zeros:

  Logical, defaults to TRUE. Should zeros at the start of the time
  series be filtered out.

- zero_threshold:

  **\[experimental\]** Numeric defaults to Inf. Indicates if detected
  zero cases are meaningful by using a threshold number of cases based
  on the 7-day average. If the average is above this threshold then the
  zero is replaced using `fill`.

- horizon:

  Deprecated; use `forecast` instead to specify the predictive horizon

## Value

An `<epinow>` object (inheriting from `<estimate_infections>`)
containing:

- `fit`: The stan fit object.

- `args`: A list of arguments used for fitting (stan data).

- `observations`: The input data (`<data.frame>`).

- `timing`: The run time (if `output` includes "timing").

## See also

[`get_samples()`](https://epiforecasts.io/EpiNow2/reference/get_samples.md)
[`get_predictions()`](https://epiforecasts.io/EpiNow2/reference/get_predictions.md)
[`get_parameters()`](https://epiforecasts.io/EpiNow2/reference/get_parameters.md)
[`estimate_infections()`](https://epiforecasts.io/EpiNow2/reference/estimate_infections.md)
[`forecast_infections()`](https://epiforecasts.io/EpiNow2/reference/forecast_infections.md)
[`regional_epinow()`](https://epiforecasts.io/EpiNow2/reference/regional_epinow.md)

## Examples

``` r
# \donttest{
# set number of cores to use
old_opts <- options()
options(mc.cores = ifelse(interactive(), 4, 1))

# set an example generation time. In practice this should use an estimate
# from the literature or be estimated from data
generation_time <- Gamma(
  shape = Normal(1.3, 0.3),
  rate = Normal(0.37, 0.09),
  max = 14
)
# set an example incubation period. In practice this should use an estimate
# from the literature or be estimated from data
incubation_period <- LogNormal(
  meanlog = Normal(1.6, 0.06),
  sdlog = Normal(0.4, 0.07),
  max = 14
)
# set an example reporting delay. In practice this should use an estimate
# from the literature or be estimated from data
reporting_delay <- LogNormal(mean = 2, sd = 1, max = 10)

# example case data
reported_cases <- example_confirmed[1:40]

# estimate Rt and nowcast/forecast cases by date of infection
# samples and calculation time have been reduced for this example
# for real analyses, use at least samples = 2000
out <- epinow(
  data = reported_cases,
  generation_time = gt_opts(generation_time),
  rt = rt_opts(prior = LogNormal(mean = 2, sd = 0.1)),
  delays = delay_opts(incubation_period + reporting_delay),
  stan = stan_opts(samples = 100, warmup = 200)
)
#> Logging threshold set at INFO for the name logger
#> Writing EpiNow2 logs to the console and:
#> /tmp/Rtmp8Pi4x1/regional-epinow/2020-04-01.log.
#> Logging threshold set at INFO for the name logger
#> Writing EpiNow2.epinow logs to the console and:
#> /tmp/Rtmp8Pi4x1/epinow/2020-04-01.log.
#> WARN [2026-02-09 09:40:51] epinow: The largest R-hat is NA, indicating chains have not mixed.
#> Running the chains for more iterations may help. See
#> https://mc-stan.org/misc/warnings.html#r-hat - 
#> WARN [2026-02-09 09:40:51] epinow: Bulk Effective Samples Size (ESS) is too low, indicating posterior means and medians may be unreliable.
#> Running the chains for more iterations may help. See
#> https://mc-stan.org/misc/warnings.html#bulk-ess - 
#> WARN [2026-02-09 09:40:51] epinow: Tail Effective Samples Size (ESS) is too low, indicating posterior variances and tail quantiles may be unreliable.
#> Running the chains for more iterations may help. See
#> https://mc-stan.org/misc/warnings.html#tail-ess - 
# summary of the latest estimates
summary(out)
#>                         measure                 estimate
#>                          <char>                   <char>
#> 1:       New infections per day      3330 (2116 -- 5462)
#> 2:   Expected change in reports               Decreasing
#> 3:   Effective reproduction no.      0.79 (0.67 -- 0.94)
#> 4:               Rate of growth -0.068 (-0.12 -- -0.011)
#> 5: Doubling/halving time (days)        -10 (-65 -- -5.8)
# plot estimates
plot(out)


# summary of R estimates
summary(out, type = "parameters", params = "R")
#>           date variable strat                           type    median
#>         <Date>   <char> <int>                         <char>     <num>
#>  1: 2020-02-22        R    NA                       estimate 2.0997758
#>  2: 2020-02-23        R    NA                       estimate 2.0733549
#>  3: 2020-02-24        R    NA                       estimate 2.0470251
#>  4: 2020-02-25        R    NA                       estimate 2.0158327
#>  5: 2020-02-26        R    NA                       estimate 1.9802070
#>  6: 2020-02-27        R    NA                       estimate 1.9459011
#>  7: 2020-02-28        R    NA                       estimate 1.9142503
#>  8: 2020-02-29        R    NA                       estimate 1.8805319
#>  9: 2020-03-01        R    NA                       estimate 1.8462355
#> 10: 2020-03-02        R    NA                       estimate 1.8063188
#> 11: 2020-03-03        R    NA                       estimate 1.7679687
#> 12: 2020-03-04        R    NA                       estimate 1.7294497
#> 13: 2020-03-05        R    NA                       estimate 1.6897636
#> 14: 2020-03-06        R    NA                       estimate 1.6448527
#> 15: 2020-03-07        R    NA                       estimate 1.5996950
#> 16: 2020-03-08        R    NA                       estimate 1.5537441
#> 17: 2020-03-09        R    NA                       estimate 1.5086539
#> 18: 2020-03-10        R    NA                       estimate 1.4646802
#> 19: 2020-03-11        R    NA                       estimate 1.4188237
#> 20: 2020-03-12        R    NA                       estimate 1.3737346
#> 21: 2020-03-13        R    NA                       estimate 1.3279981
#> 22: 2020-03-14        R    NA                       estimate 1.2848643
#> 23: 2020-03-15        R    NA                       estimate 1.2445057
#> 24: 2020-03-16        R    NA                       estimate 1.2035406
#> 25: 2020-03-17        R    NA                       estimate 1.1626288
#> 26: 2020-03-18        R    NA                       estimate 1.1259486
#> 27: 2020-03-19        R    NA estimate based on partial data 1.0876769
#> 28: 2020-03-20        R    NA estimate based on partial data 1.0530355
#> 29: 2020-03-21        R    NA estimate based on partial data 1.0218578
#> 30: 2020-03-22        R    NA estimate based on partial data 0.9920473
#> 31: 2020-03-23        R    NA estimate based on partial data 0.9639547
#> 32: 2020-03-24        R    NA estimate based on partial data 0.9373115
#> 33: 2020-03-25        R    NA estimate based on partial data 0.9115333
#> 34: 2020-03-26        R    NA estimate based on partial data 0.8876006
#> 35: 2020-03-27        R    NA estimate based on partial data 0.8653881
#> 36: 2020-03-28        R    NA estimate based on partial data 0.8482850
#> 37: 2020-03-29        R    NA estimate based on partial data 0.8308240
#> 38: 2020-03-30        R    NA estimate based on partial data 0.8140799
#> 39: 2020-03-31        R    NA estimate based on partial data 0.8007188
#> 40: 2020-04-01        R    NA estimate based on partial data 0.7912419
#> 41: 2020-04-02        R    NA                       forecast 0.7912419
#> 42: 2020-04-03        R    NA                       forecast 0.7912419
#> 43: 2020-04-04        R    NA                       forecast 0.7912419
#> 44: 2020-04-05        R    NA                       forecast 0.7912419
#> 45: 2020-04-06        R    NA                       forecast 0.7912419
#> 46: 2020-04-07        R    NA                       forecast 0.7912419
#> 47: 2020-04-08        R    NA                       forecast 0.7912419
#>           date variable strat                           type    median
#>         <Date>   <char> <int>                         <char>     <num>
#>          mean         sd  lower_90  lower_50  lower_20  upper_20  upper_50
#>         <num>      <num>     <num>     <num>     <num>     <num>     <num>
#>  1: 2.1049771 0.06620007 2.0188729 2.0647043 2.0831465 2.1127061 2.1388422
#>  2: 2.0782779 0.06155679 2.0007810 2.0360739 2.0595939 2.0860518 2.1108000
#>  3: 2.0494688 0.05879842 1.9769320 2.0069668 2.0319401 2.0565677 2.0778379
#>  4: 2.0187987 0.05744672 1.9416950 1.9757960 1.9995268 2.0242786 2.0535598
#>  5: 1.9865037 0.05673615 1.9096954 1.9453616 1.9682912 1.9957658 2.0279690
#>  6: 1.9527896 0.05591002 1.8711711 1.9120579 1.9330553 1.9658745 1.9944375
#>  7: 1.9178206 0.05446133 1.8404758 1.8791876 1.8956616 1.9325643 1.9597376
#>  8: 1.8817134 0.05223504 1.8078817 1.8391124 1.8651559 1.8972028 1.9220816
#>  9: 1.8445377 0.04941218 1.7740331 1.8062534 1.8285560 1.8568131 1.8827761
#> 10: 1.8063219 0.04640967 1.7388889 1.7696818 1.7897524 1.8158530 1.8412116
#> 11: 1.7670648 0.04371388 1.6992479 1.7339017 1.7556185 1.7771213 1.8041117
#> 12: 1.7267518 0.04167798 1.6573529 1.6980882 1.7182664 1.7370569 1.7564882
#> 13: 1.6853762 0.04036720 1.6138000 1.6603185 1.6777393 1.6956790 1.7130331
#> 14: 1.6429618 0.03955979 1.5673414 1.6200319 1.6377789 1.6533671 1.6674364
#> 15: 1.5995818 0.03890813 1.5269215 1.5775180 1.5926268 1.6079668 1.6231231
#> 16: 1.5553717 0.03813394 1.4868314 1.5341518 1.5471572 1.5638448 1.5774310
#> 17: 1.5105319 0.03713840 1.4492817 1.4865572 1.5015390 1.5175413 1.5329329
#> 18: 1.4653196 0.03600059 1.4066605 1.4393342 1.4571476 1.4731934 1.4868665
#> 19: 1.4200333 0.03489812 1.3662073 1.3957923 1.4134034 1.4238727 1.4385516
#> 20: 1.3749925 0.03400223 1.3250849 1.3563462 1.3679592 1.3792627 1.3945860
#> 21: 1.3305180 0.03340293 1.2782224 1.3096108 1.3230032 1.3363932 1.3540041
#> 22: 1.2869145 0.03310186 1.2352754 1.2648890 1.2796921 1.2956353 1.3103814
#> 23: 1.2444585 0.03306559 1.1891602 1.2212094 1.2361338 1.2547042 1.2691328
#> 24: 1.2033907 0.03329260 1.1485454 1.1816575 1.1935145 1.2136362 1.2275474
#> 25: 1.1639123 0.03384759 1.1024246 1.1442747 1.1535056 1.1722476 1.1876681
#> 26: 1.1261842 0.03484545 1.0606097 1.1063243 1.1164816 1.1325918 1.1507673
#> 27: 1.0903282 0.03639843 1.0201939 1.0688568 1.0778411 1.0994777 1.1154881
#> 28: 1.0564297 0.03856016 0.9869693 1.0313782 1.0434656 1.0674991 1.0807593
#> 29: 1.0245405 0.04130162 0.9526610 0.9959570 1.0124031 1.0329513 1.0555223
#> 30: 0.9946840 0.04453054 0.9203975 0.9649588 0.9793450 1.0033452 1.0307785
#> 31: 0.9668596 0.04813668 0.8900187 0.9302619 0.9480897 0.9759339 1.0012549
#> 32: 0.9410482 0.05203551 0.8603151 0.9014064 0.9214159 0.9502445 0.9772488
#> 33: 0.9172168 0.05619130 0.8328852 0.8735758 0.8955738 0.9269481 0.9579129
#> 34: 0.8953220 0.06061467 0.8038792 0.8556002 0.8714771 0.9047560 0.9400535
#> 35: 0.8753120 0.06533953 0.7772350 0.8333137 0.8527158 0.8844095 0.9281396
#> 36: 0.8571273 0.07039081 0.7575263 0.8116918 0.8341791 0.8649087 0.9153508
#> 37: 0.8407006 0.07575652 0.7413612 0.7908896 0.8181120 0.8511618 0.8984849
#> 38: 0.8259573 0.08137410 0.7188151 0.7692098 0.8020820 0.8385335 0.8806274
#> 39: 0.8128175 0.08713419 0.6940257 0.7529415 0.7855620 0.8274951 0.8708247
#> 40: 0.8011990 0.09289715 0.6685412 0.7368363 0.7674440 0.8159443 0.8611867
#> 41: 0.8011990 0.09289715 0.6685412 0.7368363 0.7674440 0.8159443 0.8611867
#> 42: 0.8011990 0.09289715 0.6685412 0.7368363 0.7674440 0.8159443 0.8611867
#> 43: 0.8011990 0.09289715 0.6685412 0.7368363 0.7674440 0.8159443 0.8611867
#> 44: 0.8011990 0.09289715 0.6685412 0.7368363 0.7674440 0.8159443 0.8611867
#> 45: 0.8011990 0.09289715 0.6685412 0.7368363 0.7674440 0.8159443 0.8611867
#> 46: 0.8011990 0.09289715 0.6685412 0.7368363 0.7674440 0.8159443 0.8611867
#> 47: 0.8011990 0.09289715 0.6685412 0.7368363 0.7674440 0.8159443 0.8611867
#>          mean         sd  lower_90  lower_50  lower_20  upper_20  upper_50
#>         <num>      <num>     <num>     <num>     <num>     <num>     <num>
#>      upper_90
#>         <num>
#>  1: 2.2385271
#>  2: 2.1924557
#>  3: 2.1461748
#>  4: 2.1066378
#>  5: 2.0766654
#>  6: 2.0436280
#>  7: 2.0065452
#>  8: 1.9618823
#>  9: 1.9224163
#> 10: 1.8784332
#> 11: 1.8361088
#> 12: 1.7935458
#> 13: 1.7518709
#> 14: 1.7106700
#> 15: 1.6679166
#> 16: 1.6192070
#> 17: 1.5704480
#> 18: 1.5264478
#> 19: 1.4759095
#> 20: 1.4270876
#> 21: 1.3813978
#> 22: 1.3332874
#> 23: 1.2884293
#> 24: 1.2503020
#> 25: 1.2131082
#> 26: 1.1780048
#> 27: 1.1486099
#> 28: 1.1211402
#> 29: 1.0952639
#> 30: 1.0680852
#> 31: 1.0468892
#> 32: 1.0226619
#> 33: 1.0051388
#> 34: 0.9908809
#> 35: 0.9828598
#> 36: 0.9755571
#> 37: 0.9690864
#> 38: 0.9583768
#> 39: 0.9500466
#> 40: 0.9443641
#> 41: 0.9443641
#> 42: 0.9443641
#> 43: 0.9443641
#> 44: 0.9443641
#> 45: 0.9443641
#> 46: 0.9443641
#> 47: 0.9443641
#>      upper_90
#>         <num>

options(old_opts)
# }
```
