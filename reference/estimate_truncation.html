<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Estimate Truncation of Observed Data — estimate_truncation • EpiNow2</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Estimate Truncation of Observed Data — estimate_truncation"><meta name="description" content="
Estimates a truncation distribution from multiple snapshots of the same
data source over time. This distribution can then be used passed to the
truncation argument in regional_epinow(), epinow(), and
estimate_infections() to adjust for truncated data and propagate the
uncertainty associated with data truncation into the estimates.
See here
for an example of using this approach on Covid-19 data in England. The
functionality offered by this function is now available in a more principled
manner in the epinowcast R package.
The model of truncation is as follows:
The truncation distribution is assumed to be discretised log normal wit
a mean and standard deviation that is informed by the data.
The data set with the latest observations is adjusted for truncation using
the truncation distribution.
Earlier data sets are recreated by applying the truncation distribution to
the adjusted latest observations in the time period of the earlier data set.
These data sets are then compared to the earlier observations assuming a
negative binomial observation model with an additive noise term to deal with
zero observations.


This model is then fit using stan with standard normal, or half normal,
prior for the mean, standard deviation, 1 over the square root of the
overdispersion and additive noise term.
This approach assumes that:
Current truncation is related to past truncation.
Truncation is a multiplicative scaling of underlying reported cases.
Truncation is log normally distributed.

"><meta property="og:description" content="
Estimates a truncation distribution from multiple snapshots of the same
data source over time. This distribution can then be used passed to the
truncation argument in regional_epinow(), epinow(), and
estimate_infections() to adjust for truncated data and propagate the
uncertainty associated with data truncation into the estimates.
See here
for an example of using this approach on Covid-19 data in England. The
functionality offered by this function is now available in a more principled
manner in the epinowcast R package.
The model of truncation is as follows:
The truncation distribution is assumed to be discretised log normal wit
a mean and standard deviation that is informed by the data.
The data set with the latest observations is adjusted for truncation using
the truncation distribution.
Earlier data sets are recreated by applying the truncation distribution to
the adjusted latest observations in the time period of the earlier data set.
These data sets are then compared to the earlier observations assuming a
negative binomial observation model with an additive noise term to deal with
zero observations.


This model is then fit using stan with standard normal, or half normal,
prior for the mean, standard deviation, 1 over the square root of the
overdispersion and additive noise term.
This approach assumes that:
Current truncation is related to past truncation.
Truncation is a multiplicative scaling of underlying reported cases.
Truncation is log normally distributed.

"><meta property="og:image" content="https://epiforecasts.io/EpiNow2/reference/figures/unnamed-chunk-14-1.png"><meta property="og:image:alt" content="Example estimates produced by EpiNow2 of the reproduction number, cases by date of infection and cases by date of report"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:creator" content="@seabbs"><meta name="twitter:site" content="@epiforecasts"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">EpiNow2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.7.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/EpiNow2.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-model-definitions" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Model definitions</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-model-definitions"><li><a class="dropdown-item" href="../articles/estimate_infections.html">estimate_infections()</a></li>
    <li><a class="dropdown-item" href="../articles/estimate_secondary.html">estimate_secondary()</a></li>
    <li><a class="dropdown-item" href="../articles/estimate_truncation.html">estimate_truncation()</a></li>
    <li><a class="dropdown-item" href="../articles/gaussian_process_implementation_details.html">Gaussian Process implementation details</a></li>
  </ul></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-usage" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Usage</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-usage"><li><a class="dropdown-item" href="../articles/estimate_infections_workflow.html">Workflow for Rt estimation and forecasting</a></li>
    <li><a class="dropdown-item" href="../articles/estimate_infections_options.html">Examples: estimate_infections()</a></li>
    <li><a class="dropdown-item" href="../articles/epinow.html">Using epinow() for running in production mode</a></li>
  </ul></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-case-studies" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Case studies</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-case-studies"><li><a class="dropdown-item" href="../articles/case-studies.html">External case studies and use in the literature</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/epiforecasts/EpiNow2/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Estimate Truncation of Observed Data</h1>
      <small class="dont-index">Source: <a href="https://github.com/epiforecasts/EpiNow2/blob/main/R/estimate_truncation.R" class="external-link"><code>R/estimate_truncation.R</code></a></small>
      <div class="d-none name"><code>estimate_truncation.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable" class="external-link"><img src="figures/lifecycle-stable.svg" alt="[Stable]"></a>
Estimates a truncation distribution from multiple snapshots of the same
data source over time. This distribution can then be used passed to the
<code>truncation</code> argument in <code><a href="regional_epinow.html">regional_epinow()</a></code>, <code><a href="epinow.html">epinow()</a></code>, and
<code><a href="estimate_infections.html">estimate_infections()</a></code> to adjust for truncated data and propagate the
uncertainty associated with data truncation into the estimates.</p>
<p>See <a href="https://gist.github.com/seabbs/176b0c7f83eab1a7192a25b28bbd116a" class="external-link">here</a>
for an example of using this approach on Covid-19 data in England. The
functionality offered by this function is now available in a more principled
manner in the <a href="https://package.epinowcast.org/" class="external-link"><code>epinowcast</code> R package</a>.</p>
<p>The model of truncation is as follows:</p><ol><li><p>The truncation distribution is assumed to be discretised log normal wit
a mean and standard deviation that is informed by the data.</p></li>
<li><p>The data set with the latest observations is adjusted for truncation using
the truncation distribution.</p></li>
<li><p>Earlier data sets are recreated by applying the truncation distribution to
the adjusted latest observations in the time period of the earlier data set.
These data sets are then compared to the earlier observations assuming a
negative binomial observation model with an additive noise term to deal with
zero observations.</p></li>
</ol><p>This model is then fit using <code>stan</code> with standard normal, or half normal,
prior for the mean, standard deviation, 1 over the square root of the
overdispersion and additive noise term.</p>
<p>This approach assumes that:</p><ul><li><p>Current truncation is related to past truncation.</p></li>
<li><p>Truncation is a multiplicative scaling of underlying reported cases.</p></li>
<li><p>Truncation is log normally distributed.</p></li>
</ul></div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">estimate_truncation</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  truncation <span class="op">=</span> <span class="fu"><a href="trunc_opts.html">trunc_opts</a></span><span class="op">(</span><span class="fu"><a href="Distributions.html">LogNormal</a></span><span class="op">(</span>meanlog <span class="op">=</span> <span class="fu"><a href="Distributions.html">Normal</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, sdlog <span class="op">=</span> <span class="fu"><a href="Distributions.html">Normal</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, max <span class="op">=</span></span>
<span>    <span class="fl">10</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  model <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  stan <span class="op">=</span> <span class="fu"><a href="stan_opts.html">stan_opts</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  CrIs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.5</span>, <span class="fl">0.9</span><span class="op">)</span>,</span>
<span>  filter_leading_zeros <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  zero_threshold <span class="op">=</span> <span class="cn">Inf</span>,</span>
<span>  weigh_delay_priors <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  <span class="va">obs</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>A list of <code>&lt;data.frame&gt;</code>s each containing a date variable
and a confirm (numeric) variable. Each data set should be a snapshot
of the reported data over time. All data sets must contain a complete vector
of dates.</p></dd>


<dt id="arg-truncation">truncation<a class="anchor" aria-label="anchor" href="#arg-truncation"></a></dt>
<dd><p>A call to <code><a href="trunc_opts.html">trunc_opts()</a></code> defining the truncation of
the observed data. Defaults to <code><a href="trunc_opts.html">trunc_opts()</a></code>, i.e. no truncation.  See the
<code>estimate_truncation()</code> help file for an approach to estimating this from
data where the <code>dist</code> list element returned by <code>estimate_truncation()</code> is
used as the <code>truncation</code> argument here, thereby propagating the uncertainty
in the estimate.</p></dd>


<dt id="arg-model">model<a class="anchor" aria-label="anchor" href="#arg-model"></a></dt>
<dd><p>A compiled stan model to override the default model. May be
useful for package developers or those developing extensions.</p></dd>


<dt id="arg-stan">stan<a class="anchor" aria-label="anchor" href="#arg-stan"></a></dt>
<dd><p>A list of stan options as generated by <code><a href="stan_opts.html">stan_opts()</a></code>. Defaults
to <code><a href="stan_opts.html">stan_opts()</a></code>. Can be used to override <code>data</code>, <code>init</code>, and <code>verbose</code>
settings if desired.</p></dd>


<dt id="arg-cris">CrIs<a class="anchor" aria-label="anchor" href="#arg-cris"></a></dt>
<dd><p>Numeric vector of credible intervals to calculate.</p></dd>


<dt id="arg-filter-leading-zeros">filter_leading_zeros<a class="anchor" aria-label="anchor" href="#arg-filter-leading-zeros"></a></dt>
<dd><p>Logical, defaults to TRUE. Should zeros at the
start of the time series be filtered out.</p></dd>


<dt id="arg-zero-threshold">zero_threshold<a class="anchor" aria-label="anchor" href="#arg-zero-threshold"></a></dt>
<dd><p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental" class="external-link"><img src="figures/lifecycle-experimental.svg" alt="[Experimental]"></a> Numeric defaults
to Inf. Indicates if detected zero cases are meaningful by using a threshold
number of cases based on the 7-day average. If the average is above this
threshold then the zero is replaced using <code>fill</code>.</p></dd>


<dt id="arg-weigh-delay-priors">weigh_delay_priors<a class="anchor" aria-label="anchor" href="#arg-weigh-delay-priors"></a></dt>
<dd><p>Deprecated; use the <code>weight_prior</code> option in
<code><a href="trunc_opts.html">trunc_opts()</a></code> instead.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>Logical, should model fitting progress be returned.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Additional parameters to pass to <code><a href="https://mc-stan.org/rstan/reference/stanmodel-method-sampling.html" class="external-link">rstan::sampling()</a></code>.</p></dd>


<dt id="arg-obs">obs<a class="anchor" aria-label="anchor" href="#arg-obs"></a></dt>
<dd><p>Deprecated; use <code>data</code> instead.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A list containing: the summary parameters of the truncation
distribution (<code>dist</code>), which could be passed to the <code>truncation</code> argument
of <code><a href="epinow.html">epinow()</a></code>, <code><a href="regional_epinow.html">regional_epinow()</a></code>, and <code><a href="estimate_infections.html">estimate_infections()</a></code>, the
estimated CMF of the truncation distribution (<code>cmf</code>, can be used to
adjusted new data), a <code>&lt;data.frame&gt;</code> containing the observed truncated
data, latest observed data and the adjusted for
truncation observations (<code>obs</code>), a <code>&lt;data.frame&gt;</code> containing the last
observed data (<code>last_obs</code>, useful for plotting and validation), the data
used for fitting (<code>data</code>) and the fit object (<code>fit</code>).</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="co"># set number of cores to use</span></span></span>
<span class="r-in"><span><span class="va">old_opts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>mc.cores <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/interactive.html" class="external-link">interactive</a></span><span class="op">(</span><span class="op">)</span>, <span class="fl">4</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># fit model to example data</span></span></span>
<span class="r-in"><span><span class="co"># See [example_truncated] for more details</span></span></span>
<span class="r-in"><span><span class="va">est</span> <span class="op">&lt;-</span> <span class="fu">estimate_truncation</span><span class="op">(</span><span class="va">example_truncated</span>,</span></span>
<span class="r-in"><span>  verbose <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/interactive.html" class="external-link">interactive</a></span><span class="op">(</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  chains <span class="op">=</span> <span class="fl">2</span>, iter <span class="op">=</span> <span class="fl">2000</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> WARN [2025-02-20 09:31:50] estimate_truncation (chain: 1): There were 7 divergent transitions after warmup. See</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> https://mc-stan.org/misc/warnings.html#divergent-transitions-after-warmup</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> to find out why this is a problem and how to eliminate them. - </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> WARN [2025-02-20 09:31:50] estimate_truncation (chain: 1): Examine the pairs() plot to diagnose sampling problems</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># summary of the distribution</span></span></span>
<span class="r-in"><span><span class="va">est</span><span class="op">$</span><span class="va">dist</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - lognormal distribution (max: 10):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   meanlog:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     - normal distribution:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       mean:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         -1.9</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       sd:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         0.45</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   sdlog:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     - normal distribution:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       mean:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         2.2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       sd:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         0.65</span>
<span class="r-in"><span><span class="co"># summary of the estimated truncation cmf (can be applied to new data)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">est</span><span class="op">$</span><span class="va">cmf</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     index      mean      se_mean           sd  lower_90  lower_50  lower_20</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     &lt;int&gt;     &lt;num&gt;        &lt;num&gt;        &lt;num&gt;     &lt;num&gt;     &lt;num&gt;     &lt;num&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  1:     1 1.0000000 2.996384e-18 1.241081e-16 1.0000000 1.0000000 1.0000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  2:     2 0.9972401 4.119192e-05 1.519567e-03 0.9946467 0.9961854 0.9968822</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  3:     3 0.9939038 8.772757e-05 3.253960e-03 0.9883974 0.9916302 0.9930961</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  4:     4 0.9897809 1.408050e-04 5.257126e-03 0.9810246 0.9861410 0.9883933</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  5:     5 0.9845412 2.019796e-04 7.603159e-03 0.9720983 0.9792543 0.9825026</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  6:     6 0.9776325 2.732350e-04 1.039598e-02 0.9610044 0.9703445 0.9746933</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  7:     7 0.9680494 3.568831e-04 1.378307e-02 0.9461513 0.9583565 0.9640005</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  8:     8 0.9537233 4.545126e-04 1.796668e-02 0.9253513 0.9410345 0.9482091</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  9:     9 0.9294879 5.604604e-04 2.314474e-02 0.8934592 0.9133065 0.9222476</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10:    10 0.8765754 6.184461e-04 2.874597e-02 0.8324576 0.8569271 0.8681280</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11:    11 0.4195982 3.465569e-04 1.642918e-02 0.3939804 0.4085308 0.4151351</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        median  upper_20  upper_50  upper_90</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         &lt;num&gt;     &lt;num&gt;     &lt;num&gt;     &lt;num&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  1: 1.0000000 1.0000000 1.0000000 1.0000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  2: 0.9973130 0.9977331 0.9984000 0.9995982</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  3: 0.9940481 0.9949375 0.9963661 0.9990372</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  4: 0.9899182 0.9913838 0.9937054 0.9982257</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  5: 0.9846382 0.9867015 0.9901427 0.9969796</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  6: 0.9776255 0.9804983 0.9851524 0.9950013</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  7: 0.9678872 0.9716190 0.9778215 0.9916590</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  8: 0.9532789 0.9579658 0.9661197 0.9851498</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  9: 0.9283641 0.9344218 0.9445515 0.9703486</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10: 0.8746851 0.8821058 0.8946402 0.9256043</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11: 0.4188815 0.4228498 0.4293740 0.4473664</span>
<span class="r-in"><span><span class="co"># observations linked to truncation adjusted estimates</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">est</span><span class="op">$</span><span class="va">obs</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           date confirm last_confirm report_date  mean se_mean    sd lower_90</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         &lt;Date&gt;   &lt;num&gt;        &lt;num&gt;      &lt;Date&gt; &lt;int&gt;   &lt;int&gt; &lt;int&gt;    &lt;int&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  1: 2020-03-24    4764         4789  2020-04-01  5244       0    27     5200</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  2: 2020-03-25    5191         5249  2020-04-01  5182       1    40     5117</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  3: 2020-03-26    5102         5210  2020-04-01  6060       1    64     5953</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  4: 2020-03-27    5924         6153  2020-04-01  5751       2    81     5613</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  5: 2020-03-28    5567         5959  2020-04-01  5547       2   104     5368</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  6: 2020-03-29    5289         5974  2020-04-01  4503       2   111     4310</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  7: 2020-03-30    4183         5217  2020-04-01  3046       2    99     2882</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  8: 2020-03-31    2668         4050  2020-04-01  4012       3   155     3757</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  9: 2020-04-01    1681         4053  2020-04-01     0      NA     0        0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10: 2020-03-29    5970         5974  2020-04-06  6006       0    19     5975</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11: 2020-03-30    5209         5217  2020-04-06  5262       0    27     5218</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 12: 2020-03-31    4035         4050  2020-04-06  4098       0    31     4047</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13: 2020-04-01    4020         4053  2020-04-06  4112       1    43     4040</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 14: 2020-04-02    4697         4782  2020-04-06  4853       1    69     4736</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 15: 2020-04-03    4483         4668  2020-04-06  4702       2    88     4550</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 16: 2020-04-04    4182         4585  2020-04-06  4502       2   111     4309</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17: 2020-04-05    3864         4805  2020-04-06  4412       3   143     4174</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 18: 2020-04-06    2420         4316  2020-04-06  5776       4   224     5409</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 19: 2020-04-03    4653         4668  2020-04-11  4681       0    15     4657</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 20: 2020-04-04    4554         4585  2020-04-11  4601       0    24     4562</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 21: 2020-04-05    4741         4805  2020-04-11  4815       0    37     4755</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 22: 2020-04-06    4208         4316  2020-04-11  4304       1    45     4229</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 23: 2020-04-07    3431         3599  2020-04-11  3544       1    50     3459</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 24: 2020-04-08    2779         3039  2020-04-11  2914       1    54     2820</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 25: 2020-04-09    3234         3836  2020-04-11  3481       2    86     3332</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 26: 2020-04-10    2993         4204  2020-04-11  3418       2   111     3233</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 27: 2020-04-11    1848         3951  2020-04-11  4410       3   171     4130</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 28: 2020-04-08    3036         3039  2020-04-16  3054       0    10     3038</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 29: 2020-04-09    3829         3836  2020-04-16  3868       0    20     3835</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 30: 2020-04-10    4187         4204  2020-04-16  4252       0    32     4199</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 31: 2020-04-11    3916         3951  2020-04-16  4006       1    42     3935</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 32: 2020-04-12    4605         4686  2020-04-16  4757       1    67     4643</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 33: 2020-04-13    3925         4074  2020-04-16  4116       1    77     3984</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 34: 2020-04-14    2873         3124  2020-04-16  3092       1    76     2960</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 35: 2020-04-15    2393         2919  2020-04-16  2732       1    88     2585</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 36: 2020-04-16    1512         2580  2020-04-16  3608       2   140     3379</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 37: 2020-04-13    4074         4074  2020-04-21  4099       0    13     4077</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 38: 2020-04-14    3124         3124  2020-04-21  3156       0    16     3129</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 39: 2020-04-15    2919         2919  2020-04-21  2965       0    22     2927</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 40: 2020-04-16    2580         2580  2020-04-21  2639       0    28     2592</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 41: 2020-04-17    3563         3563  2020-04-21  3681       1    52     3592</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 42: 2020-04-18    3126         3126  2020-04-21  3278       1    61     3173</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 43: 2020-04-19    2843         2843  2020-04-21  3060       1    75     2929</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 44: 2020-04-20    2051         2051  2020-04-21  2342       1    76     2215</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 45: 2020-04-21     962          962  2020-04-21  2296       1    89     2150</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           date confirm last_confirm report_date  mean se_mean    sd lower_90</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     lower_50 lower_20 median upper_20 upper_50 upper_90</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        &lt;int&gt;    &lt;int&gt;  &lt;int&gt;    &lt;int&gt;    &lt;int&gt;    &lt;int&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  1:     5223     5236   5243     5251     5263     5291</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  2:     5152     5170   5181     5192     5210     5248</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  3:     6013     6041   6059     6077     6105     6164</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  4:     5693     5729   5751     5774     5808     5883</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  5:     5474     5521   5548     5577     5620     5715</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  6:     4428     4476   4505     4535     4580     4681</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  7:     2982     3024   3050     3073     3113     3204</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  8:     3915     3975   4013     4049     4114     4266</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  9:        0        0      0        0        0        0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10:     5991     6000   6005     6011     6020     6040</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11:     5241     5254   5262     5270     5282     5309</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 12:     4075     4089   4097     4106     4120     4150</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13:     4080     4099   4112     4124     4142     4183</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 14:     4803     4834   4852     4872     4901     4964</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 15:     4640     4679   4702     4727     4763     4844</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 16:     4427     4475   4504     4534     4578     4680</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17:     4319     4380   4417     4450     4509     4641</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 18:     5636     5723   5777     5829     5923     6142</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 19:     4669     4676   4680     4685     4692     4707</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 20:     4582     4593   4600     4607     4618     4642</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 21:     4788     4804   4814     4825     4841     4877</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 22:     4271     4291   4304     4317     4336     4378</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 23:     3508     3531   3544     3559     3580     3626</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 24:     2876     2900   2915     2930     2953     3003</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 25:     3423     3460   3483     3506     3540     3619</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 26:     3345     3393   3421     3447     3492     3595</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 27:     4303     4370   4411     4451     4523     4690</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 28:     3047     3051   3054     3057     3061     3071</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 29:     3853     3862   3867     3873     3882     3903</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 30:     4228     4243   4252     4261     4275     4307</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 31:     3975     3993   4005     4017     4035     4074</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 32:     4709     4739   4757     4776     4805     4867</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 33:     4062     4097   4117     4139     4170     4241</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 34:     3041     3074   3094     3115     3145     3215</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 35:     2674     2712   2735     2756     2792     2874</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 36:     3521     3575   3609     3642     3701     3837</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 37:     4088     4094   4098     4102     4108     4121</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 38:     3143     3151   3155     3160     3167     3184</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 39:     2948     2958   2964     2970     2980     3002</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 40:     2618     2631   2639     2646     2658     2684</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 41:     3643     3667   3681     3696     3717     3765</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 42:     3235     3263   3279     3296     3321     3378</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 43:     3009     3042   3062     3082     3112     3182</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 44:     2292     2325   2344     2362     2393     2463</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 45:     2240     2275   2296     2317     2354     2441</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     lower_50 lower_20 median upper_20 upper_50 upper_90</span>
<span class="r-in"><span><span class="co"># validation plot of observations vs estimates</span></span></span>
<span class="r-in"><span><span class="fu"><a href="plot.estimate_infections.html">plot</a></span><span class="op">(</span><span class="va">est</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="estimate_truncation-1.png" alt="" width="864" height="864"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Pass the truncation distribution to `epinow()`.</span></span></span>
<span class="r-in"><span><span class="co"># Note, we're using the last snapshot as the observed data as it contains</span></span></span>
<span class="r-in"><span><span class="co"># all the previous snapshots. Also, we're using the default options for</span></span></span>
<span class="r-in"><span><span class="co"># illustrative purposes only.</span></span></span>
<span class="r-in"><span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="epinow.html">epinow</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  generation_time <span class="op">=</span> <span class="fu"><a href="generation_time_opts.html">generation_time_opts</a></span><span class="op">(</span><span class="va">example_generation_time</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="va">example_truncated</span><span class="op">[[</span><span class="fl">5</span><span class="op">]</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>  truncation <span class="op">=</span> <span class="fu"><a href="trunc_opts.html">trunc_opts</a></span><span class="op">(</span><span class="va">est</span><span class="op">$</span><span class="va">dist</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Logging threshold set at INFO for the name logger</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Writing <span style="color: #0000BB;">EpiNow2</span> logs to the console and:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #0000BB;">/tmp/RtmpXOk7Bx/regional-epinow/2020-04-21.log</span>.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Logging threshold set at INFO for the name logger</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Writing <span style="color: #0000BB;">EpiNow2.epinow</span> logs to the console and:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #0000BB;">/tmp/RtmpXOk7Bx/epinow/2020-04-21.log</span>.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> WARN [2025-02-20 09:34:42] epinow: There were 4 divergent transitions after warmup. See</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> https://mc-stan.org/misc/warnings.html#divergent-transitions-after-warmup</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> to find out why this is a problem and how to eliminate them. - </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> WARN [2025-02-20 09:34:42] epinow: Examine the pairs() plot to diagnose sampling problems</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - </span>
<span class="r-in"><span><span class="fu"><a href="plot.estimate_infections.html">plot</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="estimate_truncation-2.png" alt="" width="864" height="864"></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span><span class="va">old_opts</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://www.samabbott.co.uk/" class="external-link">Sam Abbott</a>, Joel Hellewell, Katharine Sherratt, Katelyn Gostic, Joe Hickson, Hamada S. Badr, Michael DeWitt, James M. Azam, EpiForecasts, <a href="https://www.lshtm.ac.uk/aboutus/people/funk.sebastian" class="external-link">Sebastian Funk</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

