<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Simulate infections using the renewal equation — simulate_infections • EpiNow2</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Simulate infections using the renewal equation — simulate_infections"><meta name="description" content="Simulations are done from given initial infections and, potentially
time-varying, reproduction numbers. Delays and parameters of the observation
model can be specified using the same options as in estimate_infections()."><meta property="og:description" content="Simulations are done from given initial infections and, potentially
time-varying, reproduction numbers. Delays and parameters of the observation
model can be specified using the same options as in estimate_infections()."><meta property="og:image" content="https://epiforecasts.io/EpiNow2/reference/figures/unnamed-chunk-14-1.png"><meta property="og:image:alt" content="Example estimates produced by EpiNow2 of the reproduction number, cases by date of infection and cases by date of report"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:creator" content="@seabbs"><meta name="twitter:site" content="@epiforecasts"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">EpiNow2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.8.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/EpiNow2.html">Get started</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-reference" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Reference</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-reference"><li><a class="dropdown-item" href="../reference/index.html">R Reference</a></li>
    <li><a class="dropdown-item" href="https://epiforecasts.io/EpiNow2/stan/">Stan Reference</a></li>
  </ul></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-model-definitions" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Model definitions</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-model-definitions"><li><a class="dropdown-item" href="../articles/estimate_infections.html">estimate_infections()</a></li>
    <li><a class="dropdown-item" href="../articles/estimate_secondary.html">estimate_secondary()</a></li>
    <li><a class="dropdown-item" href="../articles/estimate_truncation.html">estimate_truncation()</a></li>
    <li><a class="dropdown-item" href="../articles/gaussian_process_implementation_details.html">Gaussian Process implementation details</a></li>
  </ul></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-usage" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Usage</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-usage"><li><a class="dropdown-item" href="../articles/estimate_infections_workflow.html">Workflow for Rt estimation and forecasting</a></li>
    <li><a class="dropdown-item" href="../articles/prior_choice_guide.html">Prior choice and specification guide</a></li>
    <li><a class="dropdown-item" href="../articles/estimate_infections_options.html">Examples: estimate_infections()</a></li>
    <li><a class="dropdown-item" href="../articles/epinow.html">Using epinow() for running in production mode</a></li>
    <li><a class="dropdown-item" href="../articles/forecasting_multiple_data_streams.html">Forecasting multiple data streams</a></li>
  </ul></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-case-studies" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Case studies</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-case-studies"><li><a class="dropdown-item" href="../articles/case-studies.html">External case studies and use in the literature</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/epiforecasts/EpiNow2/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Simulate infections using the renewal equation</h1>
      <small class="dont-index">Source: <a href="https://github.com/epiforecasts/EpiNow2/blob/v1.8.0/R/simulate_infections.R" class="external-link"><code>R/simulate_infections.R</code></a></small>
      <div class="d-none name"><code>simulate_infections.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Simulations are done from given initial infections and, potentially
time-varying, reproduction numbers. Delays and parameters of the observation
model can be specified using the same options as in <code><a href="estimate_infections.html">estimate_infections()</a></code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">simulate_infections</span><span class="op">(</span></span>
<span>  <span class="va">R</span>,</span>
<span>  <span class="va">initial_infections</span>,</span>
<span>  day_of_week_effect <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  generation_time <span class="op">=</span> <span class="fu"><a href="generation_time_opts.html">generation_time_opts</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  delays <span class="op">=</span> <span class="fu"><a href="delay_opts.html">delay_opts</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  truncation <span class="op">=</span> <span class="fu"><a href="trunc_opts.html">trunc_opts</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  obs <span class="op">=</span> <span class="fu"><a href="obs_opts.html">obs_opts</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  CrIs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.5</span>, <span class="fl">0.9</span><span class="op">)</span>,</span>
<span>  backend <span class="op">=</span> <span class="st">"rstan"</span>,</span>
<span>  seeding_time <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  pop <span class="op">=</span> <span class="fu"><a href="Distributions.html">Fixed</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span>,</span>
<span>  pop_period <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"forecast"</span>, <span class="st">"all"</span><span class="op">)</span>,</span>
<span>  pop_floor <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  growth_method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"infections"</span>, <span class="st">"infectiousness"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-r">R<a class="anchor" aria-label="anchor" href="#arg-r"></a></dt>
<dd><p>a data frame of reproduction numbers (column <code>R</code>) by date (column
<code>date</code>). Column <code>R</code> must be numeric and <code>date</code> must be in date format. If
not all days between the first and last day in the <code>date</code> are present,
it will be assumed that R stays the same until the next given date.</p></dd>


<dt id="arg-initial-infections">initial_infections<a class="anchor" aria-label="anchor" href="#arg-initial-infections"></a></dt>
<dd><p>numeric; the initial number of infections (i.e.
before <code>R</code> applies). Note that results returned start the day after, i.e.
the initial number of infections is not reported again. See also
<code>seeding_time</code></p></dd>


<dt id="arg-day-of-week-effect">day_of_week_effect<a class="anchor" aria-label="anchor" href="#arg-day-of-week-effect"></a></dt>
<dd><p>either <code>NULL</code> (no day of the week effect) or a
numerical vector of length specified in <code><a href="obs_opts.html">obs_opts()</a></code> as <code>week_length</code>
(default: 7) if <code>week_effect</code> is set to TRUE. Each element of the vector
gives the weight given to reporting on this day (normalised to 1).
The default is <code>NULL</code>.</p></dd>


<dt id="arg-generation-time">generation_time<a class="anchor" aria-label="anchor" href="#arg-generation-time"></a></dt>
<dd><p>A call to <code><a href="generation_time_opts.html">gt_opts()</a></code> (or its alias
<code><a href="generation_time_opts.html">generation_time_opts()</a></code>) defining the generation time distribution used.
For backwards compatibility a list of summary parameters can also be passed.</p></dd>


<dt id="arg-delays">delays<a class="anchor" aria-label="anchor" href="#arg-delays"></a></dt>
<dd><p>A call to <code><a href="delay_opts.html">delay_opts()</a></code> defining delay distributions and
options. See the documentation of <code><a href="delay_opts.html">delay_opts()</a></code> and the examples below for
details.</p></dd>


<dt id="arg-truncation">truncation<a class="anchor" aria-label="anchor" href="#arg-truncation"></a></dt>
<dd><p>A call to <code><a href="trunc_opts.html">trunc_opts()</a></code> defining the truncation of
the observed data. Defaults to <code><a href="trunc_opts.html">trunc_opts()</a></code>, i.e. no truncation.  See the
<code><a href="estimate_truncation.html">estimate_truncation()</a></code> help file for an approach to estimating this from
data where the <code>dist</code> list element returned by <code><a href="estimate_truncation.html">estimate_truncation()</a></code> is
used as the <code>truncation</code> argument here, thereby propagating the uncertainty
in the estimate.</p></dd>


<dt id="arg-obs">obs<a class="anchor" aria-label="anchor" href="#arg-obs"></a></dt>
<dd><p>A list of options as generated by <code><a href="obs_opts.html">obs_opts()</a></code> defining the
observation model. Defaults to <code><a href="obs_opts.html">obs_opts()</a></code>.</p></dd>


<dt id="arg-cris">CrIs<a class="anchor" aria-label="anchor" href="#arg-cris"></a></dt>
<dd><p>Deprecated; specify credible intervals when using <code><a href="summary.epinow.html">summary()</a></code> or
<code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code></p></dd>


<dt id="arg-backend">backend<a class="anchor" aria-label="anchor" href="#arg-backend"></a></dt>
<dd><p>Character string indicating the backend to use for fitting
stan models. Supported arguments are "rstan" (default) or "cmdstanr".</p></dd>


<dt id="arg-seeding-time">seeding_time<a class="anchor" aria-label="anchor" href="#arg-seeding-time"></a></dt>
<dd><p>Integer; the number of days before the first time point
of <code>R</code>; default is <code>NULL</code>, in which case it is set to the maximum of the
generation time. The minimum is 1 , i.e. the first reproduction number
given applies on the day after the index cases given by
<code>initial_infections</code>. If the generation time is longer than 1 day on
average, a seeding time of 1 will always lead to an initial decline (as
there are no infections before the initial ones). Instead, if this is
greater than 1, an initial part of the epidemic (before the first value of
R given) of <code>seeding_time</code> days is assumed to have followed exponential
growth roughly in line with the growth rate implied by the first value of
R.</p></dd>


<dt id="arg-pop">pop<a class="anchor" aria-label="anchor" href="#arg-pop"></a></dt>
<dd><p>A <code>&lt;dist_spec&gt;</code> giving the initial susceptible population size.
Used to adjust Rt estimates based on the proportion of the population that
is susceptible. Defaults to <code>Fixed(0)</code> which means no population adjustment
is done. See also <code>pop_floor</code> for the numerical stability floor used when
population adjustment is enabled. When <code>pop</code> is specified, returned Rt
estimates are adjusted for susceptible depletion (accounting for population
immunity), and unadjusted Rt estimates are also provided in a separate
output variable <code>R_unadjusted</code>. Adjusted Rt represents the effective
reproduction number given the current susceptible population, whilst
unadjusted Rt represents the reproduction number that would occur in a fully
susceptible population.</p></dd>


<dt id="arg-pop-period">pop_period<a class="anchor" aria-label="anchor" href="#arg-pop-period"></a></dt>
<dd><p>Character string, defaulting to "forecast". Controls when
susceptible population adjustment is applied. "forecast" only applies the
adjustment to forecasts whilst "all" applies it to both data and forecasts.</p></dd>


<dt id="arg-pop-floor">pop_floor<a class="anchor" aria-label="anchor" href="#arg-pop-floor"></a></dt>
<dd><p>Numeric. Minimum susceptible population used as a
floor when adjusting for population depletion. This prevents numerical
instability (division by zero) when the susceptible population approaches
zero. Defaults to 1.0. Can be interpreted as representing a minimal
ongoing import level. Note that if pop_floor &gt; 0, cumulative infections
can exceed the population size, though this effect is negligible when
pop_floor is very small compared to the population size.</p></dd>


<dt id="arg-growth-method">growth_method<a class="anchor" aria-label="anchor" href="#arg-growth-method"></a></dt>
<dd><p>Method used to compute growth rates from Rt. Options
are "infections" (default) and "infectiousness". The option "infections"
uses the classical approach, i.e. computing the log derivative on the number
of new infections. The option "infectiousness" uses an alternative approach
by Parag et al., which computes the log derivative of the infectiousness
(i.e. the convolution of past infections with the generation time) and
shifts it by the mean generation time. This can provide better stability
and temporal matching with Rt. Note that, due to the temporal shift the
"infectiousness" method results in undefined (NaN) growth rates for the most
recent time points (equal to the mean generation time).</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A data.table of simulated infections (variable <code>infections</code>) and
reported cases (variable <code>reported_cases</code>) by date.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>In order to simulate, all parameters that are specified such as the mean and
standard deviation of delays or observation scaling, must be fixed.
Uncertain parameters are not allowed.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="va">R</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html" class="external-link">seq.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2023-01-01"</span><span class="op">)</span>, length.out <span class="op">=</span> <span class="fl">14</span>, by <span class="op">=</span> <span class="st">"day"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  R <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1.2</span>, <span class="fl">7</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.8</span>, <span class="fl">7</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">sim</span> <span class="op">&lt;-</span> <span class="fu">simulate_infections</span><span class="op">(</span></span></span>
<span class="r-in"><span>  R <span class="op">=</span> <span class="va">R</span>,</span></span>
<span class="r-in"><span>  initial_infections <span class="op">=</span> <span class="fl">100</span>,</span></span>
<span class="r-in"><span>  generation_time <span class="op">=</span> <span class="fu"><a href="generation_time_opts.html">generation_time_opts</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="fix_parameters.html">fix_parameters</a></span><span class="op">(</span><span class="va">example_generation_time</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span>,</span></span>
<span class="r-in"><span>  delays <span class="op">=</span> <span class="fu"><a href="delay_opts.html">delay_opts</a></span><span class="op">(</span><span class="fu"><a href="fix_parameters.html">fix_parameters</a></span><span class="op">(</span><span class="va">example_reporting_delay</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  obs <span class="op">=</span> <span class="fu"><a href="obs_opts.html">obs_opts</a></span><span class="op">(</span>family <span class="op">=</span> <span class="st">"poisson"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://www.samabbott.co.uk/" class="external-link">Sam Abbott</a>, Joel Hellewell, Katharine Sherratt, Katelyn Gostic, Joe Hickson, Hamada S. Badr, Michael DeWitt, James M. Azam, Adrian Lison, <a href="https://www.lshtm.ac.uk/aboutus/people/funk.sebastian" class="external-link">Sebastian Funk</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

