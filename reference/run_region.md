# Run epinow with Regional Processing Code

**\[maturing\]** Internal function that handles calling
[`epinow()`](https://epiforecasts.io/EpiNow2/reference/epinow.md).
Future work will extend this function to better handle stan logs and
allow the user to modify settings between regions.

## Usage

``` r
run_region(
  target_region,
  generation_time,
  delays,
  truncation,
  rt,
  backcalc,
  gp,
  obs,
  stan,
  horizon,
  CrIs,
  data,
  target_folder,
  target_date,
  return_output,
  output,
  complete_logger,
  verbose,
  progress_fn = NULL,
  ...
)
```

## Arguments

- target_region:

  Character string indicating the region being evaluated

- generation_time:

  A call to
  [`gt_opts()`](https://epiforecasts.io/EpiNow2/reference/generation_time_opts.md)
  (or its alias
  [`generation_time_opts()`](https://epiforecasts.io/EpiNow2/reference/generation_time_opts.md))
  defining the generation time distribution used. For backwards
  compatibility a list of summary parameters can also be passed.

- delays:

  A call to
  [`delay_opts()`](https://epiforecasts.io/EpiNow2/reference/delay_opts.md)
  defining delay distributions and options. See the documentation of
  [`delay_opts()`](https://epiforecasts.io/EpiNow2/reference/delay_opts.md)
  and the examples below for details.

- truncation:

  A call to
  [`trunc_opts()`](https://epiforecasts.io/EpiNow2/reference/trunc_opts.md)
  defining the truncation of the observed data. Defaults to
  [`trunc_opts()`](https://epiforecasts.io/EpiNow2/reference/trunc_opts.md),
  i.e. no truncation. See the
  [`estimate_truncation()`](https://epiforecasts.io/EpiNow2/reference/estimate_truncation.md)
  help file for an approach to estimating this from data where the
  `dist` list element returned by
  [`estimate_truncation()`](https://epiforecasts.io/EpiNow2/reference/estimate_truncation.md)
  is used as the `truncation` argument here, thereby propagating the
  uncertainty in the estimate.

- rt:

  A list of options as generated by
  [`rt_opts()`](https://epiforecasts.io/EpiNow2/reference/rt_opts.md)
  defining Rt estimation. Defaults to
  [`rt_opts()`](https://epiforecasts.io/EpiNow2/reference/rt_opts.md).
  To generate new infections using the non-mechanistic model instead of
  the renewal equation model, use `rt = NULL`. The non-mechanistic model
  internally uses the setting
  `rt = rt_opts(use_rt = FALSE, future = "project", gp_on = "R0")`.

- backcalc:

  A list of options as generated by
  [`backcalc_opts()`](https://epiforecasts.io/EpiNow2/reference/backcalc_opts.md)
  to define the back calculation. Defaults to
  [`backcalc_opts()`](https://epiforecasts.io/EpiNow2/reference/backcalc_opts.md).

- gp:

  A list of options as generated by
  [`gp_opts()`](https://epiforecasts.io/EpiNow2/reference/gp_opts.md) to
  define the Gaussian process. Defaults to
  [`gp_opts()`](https://epiforecasts.io/EpiNow2/reference/gp_opts.md).
  Set to `NULL` to disable the Gaussian process.

- obs:

  A list of options as generated by
  [`obs_opts()`](https://epiforecasts.io/EpiNow2/reference/obs_opts.md)
  defining the observation model. Defaults to
  [`obs_opts()`](https://epiforecasts.io/EpiNow2/reference/obs_opts.md).

- stan:

  A list of stan options as generated by
  [`stan_opts()`](https://epiforecasts.io/EpiNow2/reference/stan_opts.md).
  Defaults to
  [`stan_opts()`](https://epiforecasts.io/EpiNow2/reference/stan_opts.md).
  Can be used to override `data`, `init`, and `verbose` settings if
  desired.

- horizon:

  Deprecated; use `forecast` instead to specify the predictive horizon

- CrIs:

  Numeric vector of credible intervals to calculate.

- data:

  A `<data.frame>` of disease reports (confirm) by date (date), and
  region (`region`).

- target_folder:

  Character string specifying where to save results (will create if not
  present).

- target_date:

  Date, defaults to maximum found in the data if not specified.

- return_output:

  Logical, defaults to FALSE. Should output be returned, this
  automatically updates to TRUE if no directory for saving is specified.

- output:

  A character vector of optional output to return. Supported options are
  the individual regional estimates ("regions"), samples ("samples"),
  plots ("plots"), copying the individual region dated folder into a
  latest folder (if `target_folder` is not null, set using "latest"),
  the stan fit of the underlying model ("fit"), the full
  [`estimate_infections()`](https://epiforecasts.io/EpiNow2/reference/estimate_infections.md)
  return object ("estimate_infections"), and an overall summary across
  regions ("summary"). The default is to return samples and plots
  alongside summarised estimates and summary statistics. If
  `target_folder` is not NULL then the default is also to copy all
  results into a latest folder.

- complete_logger:

  Character string indicating the logger to output the completion of
  estimation to.

- verbose:

  Logical defaults to FALSE. Outputs verbose progress messages to the
  console from
  [`epinow()`](https://epiforecasts.io/EpiNow2/reference/epinow.md).

- progress_fn:

  Function as returned by
  [`progressr::progressor()`](https://progressr.futureverse.org/reference/progressor.html).
  Allows the use of a progress bar. If NULL (default), no progress bar
  is used.

- ...:

  Pass additional arguments to
  [`epinow()`](https://epiforecasts.io/EpiNow2/reference/epinow.md). See
  the documentation for
  [`epinow()`](https://epiforecasts.io/EpiNow2/reference/epinow.md) for
  details.

## Value

A list of processed output as produced by
[`process_region()`](https://epiforecasts.io/EpiNow2/reference/process_region.md)

## See also

[`regional_epinow()`](https://epiforecasts.io/EpiNow2/reference/regional_epinow.md)
